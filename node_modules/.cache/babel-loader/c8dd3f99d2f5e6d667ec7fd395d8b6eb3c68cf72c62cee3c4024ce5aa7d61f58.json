{"ast":null,"code":"// Centralized Fetch API Service for Lace and Legacy\nimport API_BASE_URL, { API_ENDPOINTS } from '../config/api';\nimport { mockProducts } from '../data/mockProducts';\nimport * as monitor from './monitor';\nfunction getAuthHeaders() {\n  const token = localStorage.getItem('token');\n  return token ? {\n    'Content-Type': 'application/json',\n    Authorization: `Bearer ${token}`\n  } : {\n    'Content-Type': 'application/json'\n  };\n}\n\n// CSRF handling (best-effort across common frameworks)\nlet __CSRF_TOKEN = null;\nlet __CSRF_HEADER_NAME = null; // 'X-XSRF-TOKEN' | 'X-CSRFToken' | 'X-CSRF-Token'\n\nfunction readCookie(name) {\n  const value = `; ${document.cookie}`;\n  const parts = value.split(`; ${name}=`);\n  if (parts.length === 2) return parts.pop().split(';').shift();\n  return null;\n}\nasync function ensureCsrfToken() {\n  // If already cached, skip network\n  if (__CSRF_TOKEN) return __CSRF_TOKEN;\n  const candidates = ['/sanctum/csrf-cookie',\n  // Laravel Sanctum\n  '/api/csrf-token', '/csrf-token', '/csrf'];\n\n  // Try to set cookies via GET and then read them\n  for (const path of candidates) {\n    try {\n      await fetch(`${API_BASE_URL}${path}`, {\n        method: 'GET',\n        credentials: 'include',\n        mode: 'cors'\n      });\n      // Check common cookie names\n      const xsrf = readCookie('XSRF-TOKEN');\n      const django = readCookie('csrftoken');\n      const generic = readCookie('CSRF-TOKEN') || readCookie('csrfToken');\n      const token = xsrf || django || generic;\n      if (token) {\n        __CSRF_TOKEN = token;\n        __CSRF_HEADER_NAME = xsrf ? 'X-XSRF-TOKEN' : django ? 'X-CSRFToken' : 'X-CSRF-Token';\n        return __CSRF_TOKEN;\n      }\n    } catch (_) {\n      // ignore and try next\n    }\n  }\n  return null;\n}\nfunction withCsrf(headers) {\n  const next = {\n    ...(headers || {})\n  };\n  if (__CSRF_TOKEN && __CSRF_HEADER_NAME) {\n    next[__CSRF_HEADER_NAME] = __CSRF_TOKEN;\n  }\n  return next;\n}\n\n// Normalize various backend auth payload shapes to a consistent contract\n// { success: boolean, token?: string, user?: object, message?: string, data?: any }\nfunction normalizeAuthPayload(raw) {\n  var _raw$data, _payload$data, _payload$data2, _payload$data3, _payload$data4, _payload$data5, _payload$data6;\n  const payload = (_raw$data = raw === null || raw === void 0 ? void 0 : raw.data) !== null && _raw$data !== void 0 ? _raw$data : raw;\n\n  // Detect if payload itself looks like a user object (common for simple backends)\n  const looksLikeUser = payload && typeof payload === 'object' && !Array.isArray(payload) && !payload.user && (payload.id || payload.email || payload.firstName && payload.lastName);\n\n  // Extract token candidates\n  const tokenCandidates = [payload === null || payload === void 0 ? void 0 : payload.token, payload === null || payload === void 0 ? void 0 : payload.accessToken, payload === null || payload === void 0 ? void 0 : payload.access_token, payload === null || payload === void 0 ? void 0 : payload.jwt, typeof (payload === null || payload === void 0 ? void 0 : payload.authorization) === 'string' ? payload === null || payload === void 0 ? void 0 : payload.authorization.replace(/^Bearer\\s+/i, '') : undefined, payload === null || payload === void 0 ? void 0 : (_payload$data = payload.data) === null || _payload$data === void 0 ? void 0 : _payload$data.token, payload === null || payload === void 0 ? void 0 : (_payload$data2 = payload.data) === null || _payload$data2 === void 0 ? void 0 : _payload$data2.accessToken, payload === null || payload === void 0 ? void 0 : (_payload$data3 = payload.data) === null || _payload$data3 === void 0 ? void 0 : _payload$data3.access_token].filter(Boolean);\n  const token = tokenCandidates[0];\n\n  // Detect success using common patterns and presence of token/user\n  const successIndicators = [(payload === null || payload === void 0 ? void 0 : payload.success) === true, String((payload === null || payload === void 0 ? void 0 : payload.status) || '').toLowerCase() === 'success', typeof (payload === null || payload === void 0 ? void 0 : payload.message) === 'string' && payload.message.toLowerCase().includes('success'), payload === true, Boolean(token), Boolean(looksLikeUser)];\n  const success = successIndicators.some(Boolean);\n\n  // Extract user candidates, fall back to payload if it looks like a user\n  const userCandidates = [payload === null || payload === void 0 ? void 0 : payload.user, payload === null || payload === void 0 ? void 0 : (_payload$data4 = payload.data) === null || _payload$data4 === void 0 ? void 0 : _payload$data4.user, payload === null || payload === void 0 ? void 0 : payload.userData, payload === null || payload === void 0 ? void 0 : (_payload$data5 = payload.data) === null || _payload$data5 === void 0 ? void 0 : _payload$data5.userInfo, payload === null || payload === void 0 ? void 0 : payload.profile, payload === null || payload === void 0 ? void 0 : (_payload$data6 = payload.data) === null || _payload$data6 === void 0 ? void 0 : _payload$data6.profile, looksLikeUser ? payload : undefined].filter(Boolean);\n  const user = userCandidates[0];\n  const message = (payload === null || payload === void 0 ? void 0 : payload.message) || (payload === null || payload === void 0 ? void 0 : payload.error) || undefined;\n  return {\n    success,\n    token,\n    user,\n    message,\n    data: payload\n  };\n}\n\n// Helper to extract data from various response formats\nfunction extractDataFromResponse(responseData) {\n  // Handle null or undefined\n  if (!responseData) return null;\n\n  // If it's already an array or object (direct response)\n  if (Array.isArray(responseData)) return responseData;\n  if (typeof responseData === 'object' && !responseData.data && !responseData.product && !responseData.products) {\n    // Check if it's a single object response (like a product)\n    if (responseData.id || responseData._id || responseData.productId || responseData.name) {\n      return responseData;\n    }\n  }\n\n  // Try common response wrapper patterns\n  const candidates = [responseData.data, responseData.product, responseData.products, responseData.items, responseData.results, responseData.payload, responseData.content, responseData.body];\n  for (const candidate of candidates) {\n    if (candidate !== undefined && candidate !== null) {\n      return candidate;\n    }\n  }\n\n  // Return the original if nothing found\n  return responseData;\n}\nfunction handleResponse(response) {\n  if (!response.ok) {\n    if (response.status === 401) {\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      localStorage.removeItem('authToken');\n      window.location.href = '/login';\n    }\n    return response.text().then(text => {\n      try {\n        const error = text ? JSON.parse(text) : {\n          message: 'Request failed',\n          status: response.status\n        };\n        return Promise.reject(error);\n      } catch (e) {\n        return Promise.reject({\n          message: text || 'Request failed',\n          status: response.status\n        });\n      }\n    });\n  }\n  // Gracefully handle empty-body 200 OK responses\n  return response.text().then(text => {\n    if (!text) {\n      // Return a normalized success payload so callers can treat it as success\n      return {\n        success: true,\n        status: 'success'\n      };\n    }\n    try {\n      const parsed = JSON.parse(text);\n      // Extract actual data from response wrappers\n      return extractDataFromResponse(parsed);\n    } catch (e) {\n      // Non-JSON success responses\n      return {\n        success: true,\n        data: text\n      };\n    }\n  });\n}\n\n// Product data normalizers\nexport function normalizeProduct(p) {\n  if (!p || typeof p !== 'object') {\n    return {\n      id: String(Math.random()),\n      name: 'Untitled Product',\n      description: '',\n      price: 0,\n      images: ['https://via.placeholder.com/800x800?text=Product'],\n      image: 'https://via.placeholder.com/800x800?text=Product',\n      era: 'Vintage',\n      decade: 'Vintage',\n      style: 'Vintage',\n      condition: 'Good',\n      colors: ['Black'],\n      color: 'Black',\n      sizes: ['M'],\n      size: 'M',\n      isNew: false,\n      inStock: true,\n      popularity: 0,\n      eraYear: 1970,\n      createdAt: new Date().toISOString()\n    };\n  }\n  const imagesArr = Array.isArray(p.images) ? p.images : p.gallery ? p.gallery : p.image ? [p.image] : [];\n  const primaryImage = imagesArr.length > 0 ? imagesArr[0] : p.thumbnail || 'https://via.placeholder.com/800x800?text=Product';\n  const colorsArr = Array.isArray(p.colors) ? p.colors : p.color ? [p.color] : ['Black'];\n  const sizesArr = Array.isArray(p.sizes) ? p.sizes : p.size ? [p.size] : ['M'];\n  const priceNum = typeof p.price === 'number' ? p.price : parseFloat(p.price);\n  const eraYr = p.eraYear || p.year || (p.createdAt ? new Date(p.createdAt).getFullYear() : undefined) || 1970;\n  return {\n    id: p.id || p._id || p.productId || p.slug || String(Math.random()),\n    name: p.name || p.title || 'Untitled Product',\n    description: p.description || p.desc || '',\n    price: Number.isFinite(priceNum) ? priceNum : 0,\n    images: imagesArr.length > 0 ? imagesArr : [primaryImage],\n    image: primaryImage,\n    era: p.era || p.decade || p.category || 'Vintage',\n    decade: p.decade || p.era || 'Vintage',\n    style: p.style || p.category || 'Vintage',\n    condition: p.condition || 'Good',\n    colors: colorsArr,\n    color: colorsArr[0],\n    sizes: sizesArr,\n    size: sizesArr[0],\n    isNew: !!p.isNew,\n    inStock: p.inStock !== undefined ? !!p.inStock : true,\n    popularity: p.popularity || 0,\n    eraYear: eraYr,\n    createdAt: p.createdAt || new Date().toISOString(),\n    category: p.category || p.style || undefined\n  };\n}\nexport function normalizeProducts(items) {\n  if (!Array.isArray(items)) return [];\n  return items.map(normalizeProduct);\n}\n\n// Attempt to extract an array of products from diverse API payload shapes\nfunction extractProductsArray(payload) {\n  if (Array.isArray(payload)) return payload;\n  // Common top-level keys\n  const topCandidates = [payload === null || payload === void 0 ? void 0 : payload.products, payload === null || payload === void 0 ? void 0 : payload.data, payload === null || payload === void 0 ? void 0 : payload.items, payload === null || payload === void 0 ? void 0 : payload.results, payload === null || payload === void 0 ? void 0 : payload.records, payload === null || payload === void 0 ? void 0 : payload.docs, payload === null || payload === void 0 ? void 0 : payload.list];\n  for (const cand of topCandidates) {\n    if (Array.isArray(cand)) return cand;\n  }\n  // Nested under data\n  const dataObj = payload === null || payload === void 0 ? void 0 : payload.data;\n  if (dataObj && typeof dataObj === 'object') {\n    const nestedCandidates = [dataObj.products, dataObj.items, dataObj.results, dataObj.records, dataObj.docs, dataObj.list];\n    for (const cand of nestedCandidates) {\n      if (Array.isArray(cand)) return cand;\n    }\n  }\n  return null;\n}\n\n// Auth services\nexport const authService = {\n  // Try both payload formats to maximize compatibility with backend\n  register: async data => {\n    const token = localStorage.getItem('token');\n    const pathsToTry = [API_ENDPOINTS.register];\n    const jsonHeaders = token ? {\n      'Content-Type': 'application/json',\n      Accept: 'application/json',\n      Authorization: `Bearer ${token}`\n    } : {\n      'Content-Type': 'application/json',\n      Accept: 'application/json'\n    };\n    let lastError;\n    // Best-effort: establish CSRF token prior to POSTs (if backend requires it)\n    try {\n      await ensureCsrfToken();\n    } catch (_) {}\n    for (const path of pathsToTry) {\n      try {\n        const url = `${API_BASE_URL}${path}`;\n        const resp = await fetch(url, {\n          method: 'POST',\n          headers: withCsrf(jsonHeaders),\n          credentials: 'include',\n          mode: 'cors',\n          body: JSON.stringify(data)\n        });\n        try {\n          console.debug('[auth:register]', 'POST', url, 'status=', resp.status);\n        } catch (_) {}\n        const parsed = await handleResponse(resp);\n        return normalizeAuthPayload(parsed);\n      } catch (err) {\n        lastError = err;\n        // continue trying other paths on 404/Not Found-like errors\n        if (err && (err.status === 404 || err.statusCode === 404)) continue;\n      }\n    }\n    throw lastError || new Error('Registration request failed');\n  },\n  login: async data => {\n    const pathsToTry = [API_ENDPOINTS.login, '/api/auth/login', '/api/registration/login'];\n    let lastError;\n    try {\n      await ensureCsrfToken();\n    } catch (_) {}\n    for (const path of pathsToTry) {\n      try {\n        const url = `${API_BASE_URL}${path}`;\n        const resp = await fetch(url, {\n          method: 'POST',\n          headers: withCsrf(getAuthHeaders()),\n          credentials: 'include',\n          mode: 'cors',\n          body: JSON.stringify(data)\n        });\n        try {\n          console.debug('[auth:login]', 'POST', url, 'status=', resp.status);\n        } catch (_) {}\n\n        // Extract potential token from headers\n        const headerAuth = resp.headers.get('authorization') || resp.headers.get('Authorization') || resp.headers.get('x-access-token') || resp.headers.get('x-auth-token');\n        const parsed = await handleResponse(resp);\n        if (headerAuth) {\n          const cleaned = headerAuth.replace(/^Bearer\\s+/i, '');\n          try {\n            localStorage.setItem('token', cleaned);\n            localStorage.setItem('authToken', cleaned);\n          } catch (_) {}\n          if (parsed && typeof parsed === 'object') {\n            parsed.authorization = headerAuth;\n            if (!parsed.token) parsed.token = cleaned;\n          }\n        }\n        const normalized = normalizeAuthPayload(parsed);\n        if (headerAuth) {\n          // Preserve raw header and cleaned token if available\n          const cleaned = headerAuth.replace(/^Bearer\\s+/i, '');\n          try {\n            localStorage.setItem('token', cleaned);\n            localStorage.setItem('authToken', cleaned);\n          } catch (_) {}\n          normalized.authorization = headerAuth;\n          if (!normalized.token) normalized.token = cleaned;\n        }\n        return normalized;\n      } catch (err) {\n        lastError = err;\n        // continue trying other paths on 404/Not Found-like errors\n        if (err && (err.status === 404 || err.statusCode === 404)) continue;\n      }\n    }\n    throw lastError || new Error('Login request failed');\n  },\n  logout: async () => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.logout}`, {\n        method: 'POST',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const result = await handleResponse(response);\n      localStorage.removeItem('token');\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('user');\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Logout failed:', error);\n      // Clear auth even on error\n      localStorage.removeItem('token');\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('user');\n      return {\n        success: true\n      };\n    }\n  },\n  verifyEmail: async data => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.verifyEmail}`, {\n        method: 'POST',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify(data)\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Email verification failed:', error);\n      throw error;\n    }\n  },\n  resendVerification: async data => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.resendVerification}`, {\n        method: 'POST',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify(data)\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Resend verification failed:', error);\n      throw error;\n    }\n  }\n};\n\n// User services\nexport const userService = {\n  getProfile: async () => {\n    const pathsToTry = [API_ENDPOINTS.profile, '/api/auth/profile', '/api/profile', '/api/users/me', '/api/user/me', '/api/me'];\n    let lastError;\n    for (const path of pathsToTry) {\n      try {\n        const resp = await fetch(`${API_BASE_URL}${path}`, {\n          headers: getAuthHeaders(),\n          credentials: 'include',\n          mode: 'cors'\n        });\n        const data = await handleResponse(resp);\n        const profile = extractDataFromResponse(data);\n        return profile || data;\n      } catch (err) {\n        lastError = err;\n        if (err && (err.status === 404 || err.statusCode === 404)) {\n          continue; // try next path on 404\n        }\n      }\n    }\n    throw lastError || {\n      message: 'Profile endpoint not found',\n      status: 404\n    };\n  },\n  updateProfile: async data => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.updateProfile}`, {\n        method: 'PUT',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify(data)\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Failed to update profile:', error);\n      throw error;\n    }\n  },\n  updatePreferences: async data => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.preferences}`, {\n        method: 'PUT',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify(data)\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Failed to update preferences:', error);\n      throw error;\n    }\n  }\n};\n\n// Product services\nexport const productService = {\n  getProducts: async params => {\n    const query = params ? '?' + new URLSearchParams(params).toString() : '';\n    const token = localStorage.getItem('token');\n    const headers = token ? {\n      Authorization: `Bearer ${token}`,\n      Accept: 'application/json'\n    } : {\n      Accept: 'application/json'\n    };\n    const primaryUrl = `${API_BASE_URL}${API_ENDPOINTS.products}${query}`;\n    const aliasPaths = [API_ENDPOINTS.products, '/api/products'\n    // Avoid non-API front-end routes that may return HTML\n    ];\n    const startTime = Date.now();\n    const isNetworkError = err => {\n      if (!err) return false;\n      const msg = String(err.message || '').toLowerCase();\n      return err.name === 'TypeError' || msg.includes('failed to fetch') || msg.includes('networkerror') || msg.includes('net::err_failed') || msg.includes('aborted') || msg.includes('request was aborted');\n    };\n    try {\n      const resp = await fetch(primaryUrl, {\n        headers,\n        mode: 'cors',\n        credentials: 'include'\n      });\n      const data = await handleResponse(resp);\n      const productsArr = extractProductsArray(data);\n      if (productsArr) {\n        const normalized = normalizeProducts(productsArr);\n        monitor.logInfo('productService.getProducts success', {\n          url: primaryUrl,\n          duration_ms: Date.now() - startTime,\n          count: normalized.length\n        });\n        return normalized;\n      }\n      // Invalid payload that cannot be parsed into products -> offline fallback\n      try {\n        window.dispatchEvent(new CustomEvent('likwapu:offline-fallback', {\n          detail: {\n            resource: 'products'\n          }\n        }));\n      } catch (_) {}\n      try {\n        window.__LIK_OFFLINE_PRODUCTS__ = true;\n      } catch (_) {}\n      monitor.logWarn('productService.getProducts invalid payload fallback', {\n        url: primaryUrl,\n        duration_ms: Date.now() - startTime,\n        payload_keys: Object.keys(data || {})\n      });\n      return mockProducts;\n    } catch (err) {\n      var _lastError, _lastError2, _lastError3;\n      monitor.logError('productService.getProducts error', {\n        url: primaryUrl,\n        duration_ms: Date.now() - startTime,\n        error_message: err === null || err === void 0 ? void 0 : err.message,\n        error_name: err === null || err === void 0 ? void 0 : err.name,\n        online: typeof navigator !== 'undefined' ? navigator.onLine : undefined\n      });\n\n      // Try alias endpoints on network errors or 404s\n      let lastError = err;\n      for (const path of aliasPaths) {\n        const altUrl = `${API_BASE_URL}${path}${query}`;\n        try {\n          const altStart = Date.now();\n          const r = await fetch(altUrl, {\n            headers,\n            mode: 'cors',\n            credentials: 'include'\n          });\n          const d = await handleResponse(r);\n          const arr = extractProductsArray(d);\n          if (arr) {\n            const normalized = normalizeProducts(arr);\n            monitor.logWarn('productService.getProducts alias success', {\n              url: altUrl,\n              duration_ms: Date.now() - altStart,\n              count: normalized.length\n            });\n            return normalized;\n          }\n          // Alias returned a non-product payload -> fallback\n          try {\n            window.dispatchEvent(new CustomEvent('likwapu:offline-fallback', {\n              detail: {\n                resource: 'products'\n              }\n            }));\n          } catch (_) {}\n          try {\n            window.__LIK_OFFLINE_PRODUCTS__ = true;\n          } catch (_) {}\n          monitor.logWarn('productService.getProducts alias invalid payload fallback', {\n            url: altUrl,\n            duration_ms: Date.now() - altStart,\n            payload_keys: Object.keys(d || {})\n          });\n          return mockProducts;\n        } catch (err2) {\n          lastError = err2;\n          // Continue trying other aliases only for network-like failures\n          if (!(isNetworkError(err2) || err2 && (err2.status === 404 || err2.statusCode === 404))) {\n            break;\n          }\n        }\n      }\n\n      // Fallback to local mock products for any fetch failure to keep UX resilient\n      try {\n        window.dispatchEvent(new CustomEvent('likwapu:offline-fallback', {\n          detail: {\n            resource: 'products'\n          }\n        }));\n      } catch (_) {}\n      try {\n        window.__LIK_OFFLINE_PRODUCTS__ = true;\n      } catch (_) {}\n      monitor.logWarn('productService.getProducts fallback to mockProducts', {\n        reason: ((_lastError = lastError) === null || _lastError === void 0 ? void 0 : _lastError.status) || ((_lastError2 = lastError) === null || _lastError2 === void 0 ? void 0 : _lastError2.name) || ((_lastError3 = lastError) === null || _lastError3 === void 0 ? void 0 : _lastError3.message) || 'unknown',\n        count: Array.isArray(mockProducts) ? mockProducts.length : 0\n      });\n      return mockProducts;\n    }\n  },\n  getProduct: async id => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.product(id)}`, {\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const data = await handleResponse(response);\n      // Extract product from response if wrapped\n      const product = extractDataFromResponse(data);\n      return normalizeProduct(product || data);\n    } catch (error) {\n      console.error('Failed to fetch product:', error);\n      throw error;\n    }\n  },\n  searchProducts: async query => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.search}?q=${encodeURIComponent(query)}`, {\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const data = await handleResponse(response);\n      const products = extractDataFromResponse(data);\n      return normalizeProducts(Array.isArray(products) ? products : []);\n    } catch (error) {\n      console.error('Failed to search products:', error);\n      return [];\n    }\n  },\n  getCategories: async () => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.categories}`, {\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const data = await handleResponse(response);\n      return extractDataFromResponse(data) || [];\n    } catch (error) {\n      console.error('Failed to fetch categories:', error);\n      return [];\n    }\n  },\n  getFilters: async () => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.filters}`, {\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const data = await handleResponse(response);\n      return extractDataFromResponse(data) || {};\n    } catch (error) {\n      console.error('Failed to fetch filters:', error);\n      return {};\n    }\n  }\n};\n\n// Review services\nexport const reviewService = {\n  getReviews: async productId => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.reviews(productId)}`, {\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const data = await handleResponse(response);\n      return extractDataFromResponse(data) || [];\n    } catch (error) {\n      console.error('Failed to fetch reviews:', error);\n      return [];\n    }\n  },\n  addReview: async (productId, data) => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.addReview(productId)}`, {\n        method: 'POST',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify(data)\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Failed to add review:', error);\n      throw error;\n    }\n  }\n};\n\n// Wishlist services\nexport const wishlistService = {\n  getWishlist: async () => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.wishlist}`, {\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const data = await handleResponse(response);\n      const products = extractDataFromResponse(data);\n      return normalizeProducts(Array.isArray(products) ? products : []);\n    } catch (error) {\n      console.error('Failed to fetch wishlist:', error);\n      return [];\n    }\n  },\n  addToWishlist: async productId => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.wishlistAdd}`, {\n        method: 'POST',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify({\n          productId\n        })\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Failed to add to wishlist:', error);\n      throw error;\n    }\n  },\n  removeFromWishlist: async productId => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.wishlistRemove}`, {\n        method: 'POST',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify({\n          productId\n        })\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Failed to remove from wishlist:', error);\n      throw error;\n    }\n  }\n};\n\n// Cart services\nexport const cartService = {\n  getCart: async () => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.cart}`, {\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const data = await handleResponse(response);\n      return extractDataFromResponse(data) || {\n        items: [],\n        total: 0\n      };\n    } catch (error) {\n      console.error('Failed to fetch cart:', error);\n      return {\n        items: [],\n        total: 0\n      };\n    }\n  },\n  addToCart: async data => {\n    try {\n      const addToCartEndpoint = typeof API_ENDPOINTS.addToCart === 'string' ? API_ENDPOINTS.addToCart.startsWith('http://') || API_ENDPOINTS.addToCart.startsWith('https://') ? API_ENDPOINTS.addToCart : `${API_BASE_URL}${API_ENDPOINTS.addToCart}` : `${API_BASE_URL}${API_ENDPOINTS.addToCart}`;\n      const response = await fetch(addToCartEndpoint, {\n        method: 'POST',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify(data)\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Failed to add to cart:', error);\n      throw error;\n    }\n  },\n  updateCart: async data => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.updateCart}`, {\n        method: 'PUT',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify(data)\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Failed to update cart:', error);\n      throw error;\n    }\n  },\n  removeFromCart: async itemId => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.removeFromCart(itemId)}`, {\n        method: 'DELETE',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Failed to remove from cart:', error);\n      throw error;\n    }\n  }\n};\n\n// Order services\nexport const orderService = {\n  getOrders: async () => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.orders}`, {\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const data = await handleResponse(response);\n      return extractDataFromResponse(data) || [];\n    } catch (error) {\n      console.error('Failed to fetch orders:', error);\n      return [];\n    }\n  },\n  getOrder: async id => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.order(id)}`, {\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors'\n      });\n      const data = await handleResponse(response);\n      return extractDataFromResponse(data) || null;\n    } catch (error) {\n      console.error('Failed to fetch order:', error);\n      throw error;\n    }\n  },\n  createOrder: async data => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.createOrder}`, {\n        method: 'POST',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify(data)\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Failed to create order:', error);\n      throw error;\n    }\n  }\n};\n\n// Contact services\nexport const contactService = {\n  sendMessage: async data => {\n    try {\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.contact}`, {\n        method: 'POST',\n        headers: getAuthHeaders(),\n        credentials: 'include',\n        mode: 'cors',\n        body: JSON.stringify(data)\n      });\n      const result = await handleResponse(response);\n      return extractDataFromResponse(result) || result;\n    } catch (error) {\n      console.error('Failed to send message:', error);\n      throw error;\n    }\n  }\n};","map":{"version":3,"names":["API_BASE_URL","API_ENDPOINTS","mockProducts","monitor","getAuthHeaders","token","localStorage","getItem","Authorization","__CSRF_TOKEN","__CSRF_HEADER_NAME","readCookie","name","value","document","cookie","parts","split","length","pop","shift","ensureCsrfToken","candidates","path","fetch","method","credentials","mode","xsrf","django","generic","_","withCsrf","headers","next","normalizeAuthPayload","raw","_raw$data","_payload$data","_payload$data2","_payload$data3","_payload$data4","_payload$data5","_payload$data6","payload","data","looksLikeUser","Array","isArray","user","id","email","firstName","lastName","tokenCandidates","accessToken","access_token","jwt","authorization","replace","undefined","filter","Boolean","successIndicators","success","String","status","toLowerCase","message","includes","some","userCandidates","userData","userInfo","profile","error","extractDataFromResponse","responseData","product","products","_id","productId","items","results","content","body","candidate","handleResponse","response","ok","removeItem","window","location","href","text","then","JSON","parse","Promise","reject","e","parsed","normalizeProduct","p","Math","random","description","price","images","image","era","decade","style","condition","colors","color","sizes","size","isNew","inStock","popularity","eraYear","createdAt","Date","toISOString","imagesArr","gallery","primaryImage","thumbnail","colorsArr","sizesArr","priceNum","parseFloat","eraYr","year","getFullYear","slug","title","desc","Number","isFinite","category","normalizeProducts","map","extractProductsArray","topCandidates","records","docs","list","cand","dataObj","nestedCandidates","authService","register","pathsToTry","jsonHeaders","Accept","lastError","url","resp","stringify","console","debug","err","statusCode","Error","login","headerAuth","get","cleaned","setItem","normalized","logout","result","verifyEmail","resendVerification","userService","getProfile","updateProfile","updatePreferences","preferences","productService","getProducts","params","query","URLSearchParams","toString","primaryUrl","aliasPaths","startTime","now","isNetworkError","msg","productsArr","logInfo","duration_ms","count","dispatchEvent","CustomEvent","detail","resource","__LIK_OFFLINE_PRODUCTS__","logWarn","payload_keys","Object","keys","_lastError","_lastError2","_lastError3","logError","error_message","error_name","online","navigator","onLine","altUrl","altStart","r","d","arr","err2","reason","getProduct","searchProducts","search","encodeURIComponent","getCategories","categories","getFilters","filters","reviewService","getReviews","reviews","addReview","wishlistService","getWishlist","wishlist","addToWishlist","wishlistAdd","removeFromWishlist","wishlistRemove","cartService","getCart","cart","total","addToCart","addToCartEndpoint","startsWith","updateCart","removeFromCart","itemId","orderService","getOrders","orders","getOrder","order","createOrder","contactService","sendMessage","contact"],"sources":["C:/Users/HP/Desktop/ikwa-clean-frontend/src/services/api.js"],"sourcesContent":["// Centralized Fetch API Service for Lace and Legacy\r\nimport API_BASE_URL, { API_ENDPOINTS } from '../config/api';\r\nimport { mockProducts } from '../data/mockProducts';\r\nimport * as monitor from './monitor';\r\n\r\nfunction getAuthHeaders() {\r\n  const token = localStorage.getItem('token');\r\n  return token\r\n    ? { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` }\r\n    : { 'Content-Type': 'application/json' };\r\n}\r\n\r\n// CSRF handling (best-effort across common frameworks)\r\nlet __CSRF_TOKEN = null;\r\nlet __CSRF_HEADER_NAME = null; // 'X-XSRF-TOKEN' | 'X-CSRFToken' | 'X-CSRF-Token'\r\n\r\nfunction readCookie(name) {\r\n  const value = `; ${document.cookie}`;\r\n  const parts = value.split(`; ${name}=`);\r\n  if (parts.length === 2) return parts.pop().split(';').shift();\r\n  return null;\r\n}\r\n\r\nasync function ensureCsrfToken() {\r\n  // If already cached, skip network\r\n  if (__CSRF_TOKEN) return __CSRF_TOKEN;\r\n\r\n  const candidates = [\r\n    '/sanctum/csrf-cookie', // Laravel Sanctum\r\n    '/api/csrf-token',\r\n    '/csrf-token',\r\n    '/csrf',\r\n  ];\r\n\r\n  // Try to set cookies via GET and then read them\r\n  for (const path of candidates) {\r\n    try {\r\n      await fetch(`${API_BASE_URL}${path}`, {\r\n        method: 'GET',\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      // Check common cookie names\r\n      const xsrf = readCookie('XSRF-TOKEN');\r\n      const django = readCookie('csrftoken');\r\n      const generic = readCookie('CSRF-TOKEN') || readCookie('csrfToken');\r\n      const token = xsrf || django || generic;\r\n      if (token) {\r\n        __CSRF_TOKEN = token;\r\n        __CSRF_HEADER_NAME = xsrf ? 'X-XSRF-TOKEN' : django ? 'X-CSRFToken' : 'X-CSRF-Token';\r\n        return __CSRF_TOKEN;\r\n      }\r\n    } catch (_) {\r\n      // ignore and try next\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction withCsrf(headers) {\r\n  const next = { ...(headers || {}) };\r\n  if (__CSRF_TOKEN && __CSRF_HEADER_NAME) {\r\n    next[__CSRF_HEADER_NAME] = __CSRF_TOKEN;\r\n  }\r\n  return next;\r\n}\r\n\r\n// Normalize various backend auth payload shapes to a consistent contract\r\n// { success: boolean, token?: string, user?: object, message?: string, data?: any }\r\nfunction normalizeAuthPayload(raw) {\r\n  const payload = raw?.data ?? raw;\r\n\r\n  // Detect if payload itself looks like a user object (common for simple backends)\r\n  const looksLikeUser = (\r\n    payload && typeof payload === 'object' && !Array.isArray(payload) && !payload.user && (\r\n      payload.id || payload.email || (payload.firstName && payload.lastName)\r\n    )\r\n  );\r\n\r\n  // Extract token candidates\r\n  const tokenCandidates = [\r\n    payload?.token,\r\n    payload?.accessToken,\r\n    payload?.access_token,\r\n    payload?.jwt,\r\n    typeof payload?.authorization === 'string' ? payload?.authorization.replace(/^Bearer\\s+/i, '') : undefined,\r\n    payload?.data?.token,\r\n    payload?.data?.accessToken,\r\n    payload?.data?.access_token,\r\n  ].filter(Boolean);\r\n  const token = tokenCandidates[0];\r\n\r\n  // Detect success using common patterns and presence of token/user\r\n  const successIndicators = [\r\n    payload?.success === true,\r\n    String(payload?.status || '').toLowerCase() === 'success',\r\n    typeof payload?.message === 'string' && payload.message.toLowerCase().includes('success'),\r\n    payload === true,\r\n    Boolean(token),\r\n    Boolean(looksLikeUser),\r\n  ];\r\n  const success = successIndicators.some(Boolean);\r\n\r\n  // Extract user candidates, fall back to payload if it looks like a user\r\n  const userCandidates = [\r\n    payload?.user,\r\n    payload?.data?.user,\r\n    payload?.userData,\r\n    payload?.data?.userInfo,\r\n    payload?.profile,\r\n    payload?.data?.profile,\r\n    looksLikeUser ? payload : undefined,\r\n  ].filter(Boolean);\r\n  const user = userCandidates[0];\r\n\r\n  const message = payload?.message || payload?.error || undefined;\r\n\r\n  return { success, token, user, message, data: payload };\r\n}\r\n\r\n// Helper to extract data from various response formats\r\nfunction extractDataFromResponse(responseData) {\r\n  // Handle null or undefined\r\n  if (!responseData) return null;\r\n  \r\n  // If it's already an array or object (direct response)\r\n  if (Array.isArray(responseData)) return responseData;\r\n  if (typeof responseData === 'object' && !responseData.data && !responseData.product && !responseData.products) {\r\n    // Check if it's a single object response (like a product)\r\n    if (responseData.id || responseData._id || responseData.productId || responseData.name) {\r\n      return responseData;\r\n    }\r\n  }\r\n  \r\n  // Try common response wrapper patterns\r\n  const candidates = [\r\n    responseData.data,\r\n    responseData.product,\r\n    responseData.products,\r\n    responseData.items,\r\n    responseData.results,\r\n    responseData.payload,\r\n    responseData.content,\r\n    responseData.body,\r\n  ];\r\n  \r\n  for (const candidate of candidates) {\r\n    if (candidate !== undefined && candidate !== null) {\r\n      return candidate;\r\n    }\r\n  }\r\n  \r\n  // Return the original if nothing found\r\n  return responseData;\r\n}\r\n\r\nfunction handleResponse(response) {\r\n  if (!response.ok) {\r\n    if (response.status === 401) {\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('user');\r\n      localStorage.removeItem('authToken');\r\n      window.location.href = '/login';\r\n    }\r\n    return response.text().then(text => {\r\n      try {\r\n        const error = text ? JSON.parse(text) : { message: 'Request failed', status: response.status };\r\n        return Promise.reject(error);\r\n      } catch (e) {\r\n        return Promise.reject({ message: text || 'Request failed', status: response.status });\r\n      }\r\n    });\r\n  }\r\n  // Gracefully handle empty-body 200 OK responses\r\n  return response.text().then(text => {\r\n    if (!text) {\r\n      // Return a normalized success payload so callers can treat it as success\r\n      return { success: true, status: 'success' };\r\n    }\r\n    try {\r\n      const parsed = JSON.parse(text);\r\n      // Extract actual data from response wrappers\r\n      return extractDataFromResponse(parsed);\r\n    } catch (e) {\r\n      // Non-JSON success responses\r\n      return { success: true, data: text };\r\n    }\r\n  });\r\n}\r\n\r\n// Product data normalizers\r\nexport function normalizeProduct(p) {\r\n  if (!p || typeof p !== 'object') {\r\n    return {\r\n      id: String(Math.random()),\r\n      name: 'Untitled Product',\r\n      description: '',\r\n      price: 0,\r\n      images: ['https://via.placeholder.com/800x800?text=Product'],\r\n      image: 'https://via.placeholder.com/800x800?text=Product',\r\n      era: 'Vintage',\r\n      decade: 'Vintage',\r\n      style: 'Vintage',\r\n      condition: 'Good',\r\n      colors: ['Black'],\r\n      color: 'Black',\r\n      sizes: ['M'],\r\n      size: 'M',\r\n      isNew: false,\r\n      inStock: true,\r\n      popularity: 0,\r\n      eraYear: 1970,\r\n      createdAt: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  const imagesArr = Array.isArray(p.images)\r\n    ? p.images\r\n    : p.gallery\r\n    ? p.gallery\r\n    : p.image\r\n    ? [p.image]\r\n    : [];\r\n\r\n  const primaryImage = imagesArr.length > 0\r\n    ? imagesArr[0]\r\n    : (p.thumbnail || 'https://via.placeholder.com/800x800?text=Product');\r\n\r\n  const colorsArr = Array.isArray(p.colors)\r\n    ? p.colors\r\n    : p.color\r\n    ? [p.color]\r\n    : ['Black'];\r\n\r\n  const sizesArr = Array.isArray(p.sizes)\r\n    ? p.sizes\r\n    : p.size\r\n    ? [p.size]\r\n    : ['M'];\r\n\r\n  const priceNum = typeof p.price === 'number' ? p.price : parseFloat(p.price);\r\n  const eraYr = p.eraYear || p.year || (p.createdAt ? new Date(p.createdAt).getFullYear() : undefined) || 1970;\r\n\r\n  return {\r\n    id: p.id || p._id || p.productId || p.slug || String(Math.random()),\r\n    name: p.name || p.title || 'Untitled Product',\r\n    description: p.description || p.desc || '',\r\n    price: Number.isFinite(priceNum) ? priceNum : 0,\r\n    images: imagesArr.length > 0 ? imagesArr : [primaryImage],\r\n    image: primaryImage,\r\n    era: p.era || p.decade || p.category || 'Vintage',\r\n    decade: p.decade || p.era || 'Vintage',\r\n    style: p.style || p.category || 'Vintage',\r\n    condition: p.condition || 'Good',\r\n    colors: colorsArr,\r\n    color: colorsArr[0],\r\n    sizes: sizesArr,\r\n    size: sizesArr[0],\r\n    isNew: !!p.isNew,\r\n    inStock: p.inStock !== undefined ? !!p.inStock : true,\r\n    popularity: p.popularity || 0,\r\n    eraYear: eraYr,\r\n    createdAt: p.createdAt || new Date().toISOString(),\r\n    category: p.category || p.style || undefined,\r\n  };\r\n}\r\n\r\nexport function normalizeProducts(items) {\r\n  if (!Array.isArray(items)) return [];\r\n  return items.map(normalizeProduct);\r\n}\r\n\r\n// Attempt to extract an array of products from diverse API payload shapes\r\nfunction extractProductsArray(payload) {\r\n  if (Array.isArray(payload)) return payload;\r\n  // Common top-level keys\r\n  const topCandidates = [\r\n    payload?.products,\r\n    payload?.data,\r\n    payload?.items,\r\n    payload?.results,\r\n    payload?.records,\r\n    payload?.docs,\r\n    payload?.list,\r\n  ];\r\n  for (const cand of topCandidates) {\r\n    if (Array.isArray(cand)) return cand;\r\n  }\r\n  // Nested under data\r\n  const dataObj = payload?.data;\r\n  if (dataObj && typeof dataObj === 'object') {\r\n    const nestedCandidates = [\r\n      dataObj.products,\r\n      dataObj.items,\r\n      dataObj.results,\r\n      dataObj.records,\r\n      dataObj.docs,\r\n      dataObj.list,\r\n    ];\r\n    for (const cand of nestedCandidates) {\r\n      if (Array.isArray(cand)) return cand;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n// Auth services\r\nexport const authService = {\r\n  // Try both payload formats to maximize compatibility with backend\r\n  register: async (data) => {\r\n    const token = localStorage.getItem('token');\r\n    const pathsToTry = [\r\n      API_ENDPOINTS.register,\r\n    ];\r\n\r\n    const jsonHeaders = token\r\n      ? { 'Content-Type': 'application/json', Accept: 'application/json', Authorization: `Bearer ${token}` }\r\n      : { 'Content-Type': 'application/json', Accept: 'application/json' };\r\n\r\n    let lastError;\r\n    // Best-effort: establish CSRF token prior to POSTs (if backend requires it)\r\n    try { await ensureCsrfToken(); } catch (_) {}\r\n    for (const path of pathsToTry) {\r\n      try {\r\n        const url = `${API_BASE_URL}${path}`;\r\n        const resp = await fetch(url, {\r\n          method: 'POST',\r\n          headers: withCsrf(jsonHeaders),\r\n          credentials: 'include',\r\n          mode: 'cors',\r\n          body: JSON.stringify(data),\r\n        });\r\n        try { console.debug('[auth:register]', 'POST', url, 'status=', resp.status); } catch (_) {}\r\n        const parsed = await handleResponse(resp);\r\n        return normalizeAuthPayload(parsed);\r\n      } catch (err) {\r\n        lastError = err;\r\n        // continue trying other paths on 404/Not Found-like errors\r\n        if (err && (err.status === 404 || err.statusCode === 404)) continue;\r\n      }\r\n    }\r\n    throw lastError || new Error('Registration request failed');\r\n  },\r\n  login: async (data) => {\r\n    const pathsToTry = [\r\n      API_ENDPOINTS.login,\r\n      '/api/auth/login',\r\n      '/api/registration/login',\r\n    ];\r\n\r\n    let lastError;\r\n    try { await ensureCsrfToken(); } catch (_) {}\r\n    for (const path of pathsToTry) {\r\n      try {\r\n        const url = `${API_BASE_URL}${path}`;\r\n        const resp = await fetch(url, {\r\n          method: 'POST',\r\n          headers: withCsrf(getAuthHeaders()),\r\n          credentials: 'include',\r\n          mode: 'cors',\r\n          body: JSON.stringify(data),\r\n        });\r\n        try { console.debug('[auth:login]', 'POST', url, 'status=', resp.status); } catch (_) {}\r\n\r\n        // Extract potential token from headers\r\n        const headerAuth =\r\n          resp.headers.get('authorization') ||\r\n          resp.headers.get('Authorization') ||\r\n          resp.headers.get('x-access-token') ||\r\n          resp.headers.get('x-auth-token');\r\n\r\n        const parsed = await handleResponse(resp);\r\n\r\n        if (headerAuth) {\r\n          const cleaned = headerAuth.replace(/^Bearer\\s+/i, '');\r\n          try {\r\n            localStorage.setItem('token', cleaned);\r\n            localStorage.setItem('authToken', cleaned);\r\n          } catch (_) {}\r\n          if (parsed && typeof parsed === 'object') {\r\n            parsed.authorization = headerAuth;\r\n            if (!parsed.token) parsed.token = cleaned;\r\n          }\r\n        }\r\n\r\n        const normalized = normalizeAuthPayload(parsed);\r\n        if (headerAuth) {\r\n          // Preserve raw header and cleaned token if available\r\n          const cleaned = headerAuth.replace(/^Bearer\\s+/i, '');\r\n          try {\r\n            localStorage.setItem('token', cleaned);\r\n            localStorage.setItem('authToken', cleaned);\r\n          } catch (_) {}\r\n          normalized.authorization = headerAuth;\r\n          if (!normalized.token) normalized.token = cleaned;\r\n        }\r\n        return normalized;\r\n      } catch (err) {\r\n        lastError = err;\r\n        // continue trying other paths on 404/Not Found-like errors\r\n        if (err && (err.status === 404 || err.statusCode === 404)) continue;\r\n      }\r\n    }\r\n    throw lastError || new Error('Login request failed');\r\n  },\r\n  logout: async () => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.logout}`, {\r\n        method: 'POST',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const result = await handleResponse(response);\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('authToken');\r\n      localStorage.removeItem('user');\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Logout failed:', error);\r\n      // Clear auth even on error\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('authToken');\r\n      localStorage.removeItem('user');\r\n      return { success: true };\r\n    }\r\n  },\r\n  verifyEmail: async (data) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.verifyEmail}`, {\r\n        method: 'POST',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify(data),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Email verification failed:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  resendVerification: async (data) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.resendVerification}`, {\r\n        method: 'POST',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify(data),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Resend verification failed:', error);\r\n      throw error;\r\n    }\r\n  },\r\n};\r\n\r\n// User services\r\nexport const userService = {\r\n  getProfile: async () => {\r\n    const pathsToTry = [\r\n      API_ENDPOINTS.profile,\r\n      '/api/auth/profile',\r\n      '/api/profile',\r\n      '/api/users/me',\r\n      '/api/user/me',\r\n      '/api/me',\r\n    ];\r\n\r\n    let lastError;\r\n    for (const path of pathsToTry) {\r\n      try {\r\n        const resp = await fetch(`${API_BASE_URL}${path}`, {\r\n          headers: getAuthHeaders(),\r\n          credentials: 'include',\r\n          mode: 'cors',\r\n        });\r\n        const data = await handleResponse(resp);\r\n        const profile = extractDataFromResponse(data);\r\n        return profile || data;\r\n      } catch (err) {\r\n        lastError = err;\r\n        if (err && (err.status === 404 || err.statusCode === 404)) {\r\n          continue; // try next path on 404\r\n        }\r\n      }\r\n    }\r\n    throw lastError || { message: 'Profile endpoint not found', status: 404 };\r\n  },\r\n  updateProfile: async (data) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.updateProfile}`, {\r\n        method: 'PUT',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify(data),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Failed to update profile:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  updatePreferences: async (data) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.preferences}`, {\r\n        method: 'PUT',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify(data),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Failed to update preferences:', error);\r\n      throw error;\r\n    }\r\n  },\r\n};\r\n\r\n// Product services\r\nexport const productService = {\r\n  getProducts: async (params) => {\r\n    const query = params ? '?' + new URLSearchParams(params).toString() : '';\r\n    const token = localStorage.getItem('token');\r\n    const headers = token ? { Authorization: `Bearer ${token}`, Accept: 'application/json' } : { Accept: 'application/json' };\r\n\r\n    const primaryUrl = `${API_BASE_URL}${API_ENDPOINTS.products}${query}`;\r\n    const aliasPaths = [\r\n      API_ENDPOINTS.products,\r\n      '/api/products',\r\n      // Avoid non-API front-end routes that may return HTML\r\n    ];\r\n\r\n    const startTime = Date.now();\r\n    const isNetworkError = (err) => {\r\n      if (!err) return false;\r\n      const msg = String(err.message || '').toLowerCase();\r\n      return (\r\n        err.name === 'TypeError' ||\r\n        msg.includes('failed to fetch') ||\r\n        msg.includes('networkerror') ||\r\n        msg.includes('net::err_failed') ||\r\n        msg.includes('aborted') ||\r\n        msg.includes('request was aborted')\r\n      );\r\n    };\r\n\r\n    try {\r\n      const resp = await fetch(primaryUrl, {\r\n        headers,\r\n        mode: 'cors',\r\n        credentials: 'include',\r\n      });\r\n      const data = await handleResponse(resp);\r\n      const productsArr = extractProductsArray(data);\r\n      if (productsArr) {\r\n        const normalized = normalizeProducts(productsArr);\r\n        monitor.logInfo('productService.getProducts success', {\r\n          url: primaryUrl,\r\n          duration_ms: Date.now() - startTime,\r\n          count: normalized.length,\r\n        });\r\n        return normalized;\r\n      }\r\n      // Invalid payload that cannot be parsed into products -> offline fallback\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('likwapu:offline-fallback', { detail: { resource: 'products' } }));\r\n      } catch (_) {}\r\n      try { window.__LIK_OFFLINE_PRODUCTS__ = true; } catch (_) {}\r\n      monitor.logWarn('productService.getProducts invalid payload fallback', {\r\n        url: primaryUrl,\r\n        duration_ms: Date.now() - startTime,\r\n        payload_keys: Object.keys(data || {}),\r\n      });\r\n      return mockProducts;\r\n    } catch (err) {\r\n      monitor.logError('productService.getProducts error', {\r\n        url: primaryUrl,\r\n        duration_ms: Date.now() - startTime,\r\n        error_message: err?.message,\r\n        error_name: err?.name,\r\n        online: typeof navigator !== 'undefined' ? navigator.onLine : undefined,\r\n      });\r\n\r\n      // Try alias endpoints on network errors or 404s\r\n      let lastError = err;\r\n      for (const path of aliasPaths) {\r\n        const altUrl = `${API_BASE_URL}${path}${query}`;\r\n        try {\r\n          const altStart = Date.now();\r\n          const r = await fetch(altUrl, { headers, mode: 'cors', credentials: 'include' });\r\n          const d = await handleResponse(r);\r\n          const arr = extractProductsArray(d);\r\n          if (arr) {\r\n            const normalized = normalizeProducts(arr);\r\n            monitor.logWarn('productService.getProducts alias success', {\r\n              url: altUrl,\r\n              duration_ms: Date.now() - altStart,\r\n              count: normalized.length,\r\n            });\r\n            return normalized;\r\n          }\r\n          // Alias returned a non-product payload -> fallback\r\n          try {\r\n            window.dispatchEvent(new CustomEvent('likwapu:offline-fallback', { detail: { resource: 'products' } }));\r\n          } catch (_) {}\r\n          try { window.__LIK_OFFLINE_PRODUCTS__ = true; } catch (_) {}\r\n          monitor.logWarn('productService.getProducts alias invalid payload fallback', {\r\n            url: altUrl,\r\n            duration_ms: Date.now() - altStart,\r\n            payload_keys: Object.keys(d || {}),\r\n          });\r\n          return mockProducts;\r\n        } catch (err2) {\r\n          lastError = err2;\r\n          // Continue trying other aliases only for network-like failures\r\n          if (!(isNetworkError(err2) || (err2 && (err2.status === 404 || err2.statusCode === 404)))) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Fallback to local mock products for any fetch failure to keep UX resilient\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('likwapu:offline-fallback', { detail: { resource: 'products' } }));\r\n      } catch (_) {}\r\n      try { window.__LIK_OFFLINE_PRODUCTS__ = true; } catch (_) {}\r\n      monitor.logWarn('productService.getProducts fallback to mockProducts', {\r\n        reason: (lastError?.status || lastError?.name || lastError?.message || 'unknown'),\r\n        count: Array.isArray(mockProducts) ? mockProducts.length : 0,\r\n      });\r\n      return mockProducts;\r\n    }\r\n  },\r\n  getProduct: async (id) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.product(id)}`, {\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const data = await handleResponse(response);\r\n      // Extract product from response if wrapped\r\n      const product = extractDataFromResponse(data);\r\n      return normalizeProduct(product || data);\r\n    } catch (error) {\r\n      console.error('Failed to fetch product:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  searchProducts: async (query) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.search}?q=${encodeURIComponent(query)}`, {\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const data = await handleResponse(response);\r\n      const products = extractDataFromResponse(data);\r\n      return normalizeProducts(Array.isArray(products) ? products : []);\r\n    } catch (error) {\r\n      console.error('Failed to search products:', error);\r\n      return [];\r\n    }\r\n  },\r\n  getCategories: async () => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.categories}`, {\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const data = await handleResponse(response);\r\n      return extractDataFromResponse(data) || [];\r\n    } catch (error) {\r\n      console.error('Failed to fetch categories:', error);\r\n      return [];\r\n    }\r\n  },\r\n  getFilters: async () => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.filters}`, {\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const data = await handleResponse(response);\r\n      return extractDataFromResponse(data) || {};\r\n    } catch (error) {\r\n      console.error('Failed to fetch filters:', error);\r\n      return {};\r\n    }\r\n  },\r\n};\r\n\r\n// Review services\r\nexport const reviewService = {\r\n  getReviews: async (productId) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.reviews(productId)}`, {\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const data = await handleResponse(response);\r\n      return extractDataFromResponse(data) || [];\r\n    } catch (error) {\r\n      console.error('Failed to fetch reviews:', error);\r\n      return [];\r\n    }\r\n  },\r\n  addReview: async (productId, data) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.addReview(productId)}`, {\r\n        method: 'POST',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify(data),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Failed to add review:', error);\r\n      throw error;\r\n    }\r\n  },\r\n};\r\n\r\n// Wishlist services\r\nexport const wishlistService = {\r\n  getWishlist: async () => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.wishlist}`, {\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const data = await handleResponse(response);\r\n      const products = extractDataFromResponse(data);\r\n      return normalizeProducts(Array.isArray(products) ? products : []);\r\n    } catch (error) {\r\n      console.error('Failed to fetch wishlist:', error);\r\n      return [];\r\n    }\r\n  },\r\n  addToWishlist: async (productId) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.wishlistAdd}`, {\r\n        method: 'POST',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify({ productId }),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Failed to add to wishlist:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  removeFromWishlist: async (productId) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.wishlistRemove}`, {\r\n        method: 'POST',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify({ productId }),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Failed to remove from wishlist:', error);\r\n      throw error;\r\n    }\r\n  },\r\n};\r\n\r\n// Cart services\r\nexport const cartService = {\r\n  getCart: async () => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.cart}`, {\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const data = await handleResponse(response);\r\n      return extractDataFromResponse(data) || { items: [], total: 0 };\r\n    } catch (error) {\r\n      console.error('Failed to fetch cart:', error);\r\n      return { items: [], total: 0 };\r\n    }\r\n  },\r\n  addToCart: async (data) => {\r\n    try {\r\n      const addToCartEndpoint = typeof API_ENDPOINTS.addToCart === 'string'\r\n        ? (API_ENDPOINTS.addToCart.startsWith('http://') || API_ENDPOINTS.addToCart.startsWith('https://')\r\n            ? API_ENDPOINTS.addToCart\r\n            : `${API_BASE_URL}${API_ENDPOINTS.addToCart}`)\r\n        : `${API_BASE_URL}${API_ENDPOINTS.addToCart}`;\r\n\r\n      const response = await fetch(addToCartEndpoint, {\r\n        method: 'POST',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify(data),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Failed to add to cart:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  updateCart: async (data) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.updateCart}`, {\r\n        method: 'PUT',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify(data),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Failed to update cart:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  removeFromCart: async (itemId) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.removeFromCart(itemId)}`, {\r\n        method: 'DELETE',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Failed to remove from cart:', error);\r\n      throw error;\r\n    }\r\n  },\r\n};\r\n\r\n// Order services\r\nexport const orderService = {\r\n  getOrders: async () => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.orders}`, {\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const data = await handleResponse(response);\r\n      return extractDataFromResponse(data) || [];\r\n    } catch (error) {\r\n      console.error('Failed to fetch orders:', error);\r\n      return [];\r\n    }\r\n  },\r\n  getOrder: async (id) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.order(id)}`, {\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n      });\r\n      const data = await handleResponse(response);\r\n      return extractDataFromResponse(data) || null;\r\n    } catch (error) {\r\n      console.error('Failed to fetch order:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  createOrder: async (data) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.createOrder}`, {\r\n        method: 'POST',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify(data),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Failed to create order:', error);\r\n      throw error;\r\n    }\r\n  },\r\n};\r\n\r\n// Contact services\r\nexport const contactService = {\r\n  sendMessage: async (data) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.contact}`, {\r\n        method: 'POST',\r\n        headers: getAuthHeaders(),\r\n        credentials: 'include',\r\n        mode: 'cors',\r\n        body: JSON.stringify(data),\r\n      });\r\n      const result = await handleResponse(response);\r\n      return extractDataFromResponse(result) || result;\r\n    } catch (error) {\r\n      console.error('Failed to send message:', error);\r\n      throw error;\r\n    }\r\n  },\r\n};\r\n"],"mappings":"AAAA;AACA,OAAOA,YAAY,IAAIC,aAAa,QAAQ,eAAe;AAC3D,SAASC,YAAY,QAAQ,sBAAsB;AACnD,OAAO,KAAKC,OAAO,MAAM,WAAW;AAEpC,SAASC,cAAcA,CAAA,EAAG;EACxB,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,OAAOF,KAAK,GACR;IAAE,cAAc,EAAE,kBAAkB;IAAEG,aAAa,EAAE,UAAUH,KAAK;EAAG,CAAC,GACxE;IAAE,cAAc,EAAE;EAAmB,CAAC;AAC5C;;AAEA;AACA,IAAII,YAAY,GAAG,IAAI;AACvB,IAAIC,kBAAkB,GAAG,IAAI,CAAC,CAAC;;AAE/B,SAASC,UAAUA,CAACC,IAAI,EAAE;EACxB,MAAMC,KAAK,GAAG,KAAKC,QAAQ,CAACC,MAAM,EAAE;EACpC,MAAMC,KAAK,GAAGH,KAAK,CAACI,KAAK,CAAC,KAAKL,IAAI,GAAG,CAAC;EACvC,IAAII,KAAK,CAACE,MAAM,KAAK,CAAC,EAAE,OAAOF,KAAK,CAACG,GAAG,CAAC,CAAC,CAACF,KAAK,CAAC,GAAG,CAAC,CAACG,KAAK,CAAC,CAAC;EAC7D,OAAO,IAAI;AACb;AAEA,eAAeC,eAAeA,CAAA,EAAG;EAC/B;EACA,IAAIZ,YAAY,EAAE,OAAOA,YAAY;EAErC,MAAMa,UAAU,GAAG,CACjB,sBAAsB;EAAE;EACxB,iBAAiB,EACjB,aAAa,EACb,OAAO,CACR;;EAED;EACA,KAAK,MAAMC,IAAI,IAAID,UAAU,EAAE;IAC7B,IAAI;MACF,MAAME,KAAK,CAAC,GAAGxB,YAAY,GAAGuB,IAAI,EAAE,EAAE;QACpCE,MAAM,EAAE,KAAK;QACbC,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF;MACA,MAAMC,IAAI,GAAGjB,UAAU,CAAC,YAAY,CAAC;MACrC,MAAMkB,MAAM,GAAGlB,UAAU,CAAC,WAAW,CAAC;MACtC,MAAMmB,OAAO,GAAGnB,UAAU,CAAC,YAAY,CAAC,IAAIA,UAAU,CAAC,WAAW,CAAC;MACnE,MAAMN,KAAK,GAAGuB,IAAI,IAAIC,MAAM,IAAIC,OAAO;MACvC,IAAIzB,KAAK,EAAE;QACTI,YAAY,GAAGJ,KAAK;QACpBK,kBAAkB,GAAGkB,IAAI,GAAG,cAAc,GAAGC,MAAM,GAAG,aAAa,GAAG,cAAc;QACpF,OAAOpB,YAAY;MACrB;IACF,CAAC,CAAC,OAAOsB,CAAC,EAAE;MACV;IAAA;EAEJ;EACA,OAAO,IAAI;AACb;AAEA,SAASC,QAAQA,CAACC,OAAO,EAAE;EACzB,MAAMC,IAAI,GAAG;IAAE,IAAID,OAAO,IAAI,CAAC,CAAC;EAAE,CAAC;EACnC,IAAIxB,YAAY,IAAIC,kBAAkB,EAAE;IACtCwB,IAAI,CAACxB,kBAAkB,CAAC,GAAGD,YAAY;EACzC;EACA,OAAOyB,IAAI;AACb;;AAEA;AACA;AACA,SAASC,oBAAoBA,CAACC,GAAG,EAAE;EAAA,IAAAC,SAAA,EAAAC,aAAA,EAAAC,cAAA,EAAAC,cAAA,EAAAC,cAAA,EAAAC,cAAA,EAAAC,cAAA;EACjC,MAAMC,OAAO,IAAAP,SAAA,GAAGD,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAES,IAAI,cAAAR,SAAA,cAAAA,SAAA,GAAID,GAAG;;EAEhC;EACA,MAAMU,aAAa,GACjBF,OAAO,IAAI,OAAOA,OAAO,KAAK,QAAQ,IAAI,CAACG,KAAK,CAACC,OAAO,CAACJ,OAAO,CAAC,IAAI,CAACA,OAAO,CAACK,IAAI,KAChFL,OAAO,CAACM,EAAE,IAAIN,OAAO,CAACO,KAAK,IAAKP,OAAO,CAACQ,SAAS,IAAIR,OAAO,CAACS,QAAS,CAEzE;;EAED;EACA,MAAMC,eAAe,GAAG,CACtBV,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEvC,KAAK,EACduC,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEW,WAAW,EACpBX,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEY,YAAY,EACrBZ,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEa,GAAG,EACZ,QAAOb,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEc,aAAa,MAAK,QAAQ,GAAGd,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEc,aAAa,CAACC,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC,GAAGC,SAAS,EAC1GhB,OAAO,aAAPA,OAAO,wBAAAN,aAAA,GAAPM,OAAO,CAAEC,IAAI,cAAAP,aAAA,uBAAbA,aAAA,CAAejC,KAAK,EACpBuC,OAAO,aAAPA,OAAO,wBAAAL,cAAA,GAAPK,OAAO,CAAEC,IAAI,cAAAN,cAAA,uBAAbA,cAAA,CAAegB,WAAW,EAC1BX,OAAO,aAAPA,OAAO,wBAAAJ,cAAA,GAAPI,OAAO,CAAEC,IAAI,cAAAL,cAAA,uBAAbA,cAAA,CAAegB,YAAY,CAC5B,CAACK,MAAM,CAACC,OAAO,CAAC;EACjB,MAAMzD,KAAK,GAAGiD,eAAe,CAAC,CAAC,CAAC;;EAEhC;EACA,MAAMS,iBAAiB,GAAG,CACxB,CAAAnB,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEoB,OAAO,MAAK,IAAI,EACzBC,MAAM,CAAC,CAAArB,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEsB,MAAM,KAAI,EAAE,CAAC,CAACC,WAAW,CAAC,CAAC,KAAK,SAAS,EACzD,QAAOvB,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEwB,OAAO,MAAK,QAAQ,IAAIxB,OAAO,CAACwB,OAAO,CAACD,WAAW,CAAC,CAAC,CAACE,QAAQ,CAAC,SAAS,CAAC,EACzFzB,OAAO,KAAK,IAAI,EAChBkB,OAAO,CAACzD,KAAK,CAAC,EACdyD,OAAO,CAAChB,aAAa,CAAC,CACvB;EACD,MAAMkB,OAAO,GAAGD,iBAAiB,CAACO,IAAI,CAACR,OAAO,CAAC;;EAE/C;EACA,MAAMS,cAAc,GAAG,CACrB3B,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEK,IAAI,EACbL,OAAO,aAAPA,OAAO,wBAAAH,cAAA,GAAPG,OAAO,CAAEC,IAAI,cAAAJ,cAAA,uBAAbA,cAAA,CAAeQ,IAAI,EACnBL,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAE4B,QAAQ,EACjB5B,OAAO,aAAPA,OAAO,wBAAAF,cAAA,GAAPE,OAAO,CAAEC,IAAI,cAAAH,cAAA,uBAAbA,cAAA,CAAe+B,QAAQ,EACvB7B,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAE8B,OAAO,EAChB9B,OAAO,aAAPA,OAAO,wBAAAD,cAAA,GAAPC,OAAO,CAAEC,IAAI,cAAAF,cAAA,uBAAbA,cAAA,CAAe+B,OAAO,EACtB5B,aAAa,GAAGF,OAAO,GAAGgB,SAAS,CACpC,CAACC,MAAM,CAACC,OAAO,CAAC;EACjB,MAAMb,IAAI,GAAGsB,cAAc,CAAC,CAAC,CAAC;EAE9B,MAAMH,OAAO,GAAG,CAAAxB,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEwB,OAAO,MAAIxB,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAE+B,KAAK,KAAIf,SAAS;EAE/D,OAAO;IAAEI,OAAO;IAAE3D,KAAK;IAAE4C,IAAI;IAAEmB,OAAO;IAAEvB,IAAI,EAAED;EAAQ,CAAC;AACzD;;AAEA;AACA,SAASgC,uBAAuBA,CAACC,YAAY,EAAE;EAC7C;EACA,IAAI,CAACA,YAAY,EAAE,OAAO,IAAI;;EAE9B;EACA,IAAI9B,KAAK,CAACC,OAAO,CAAC6B,YAAY,CAAC,EAAE,OAAOA,YAAY;EACpD,IAAI,OAAOA,YAAY,KAAK,QAAQ,IAAI,CAACA,YAAY,CAAChC,IAAI,IAAI,CAACgC,YAAY,CAACC,OAAO,IAAI,CAACD,YAAY,CAACE,QAAQ,EAAE;IAC7G;IACA,IAAIF,YAAY,CAAC3B,EAAE,IAAI2B,YAAY,CAACG,GAAG,IAAIH,YAAY,CAACI,SAAS,IAAIJ,YAAY,CAACjE,IAAI,EAAE;MACtF,OAAOiE,YAAY;IACrB;EACF;;EAEA;EACA,MAAMvD,UAAU,GAAG,CACjBuD,YAAY,CAAChC,IAAI,EACjBgC,YAAY,CAACC,OAAO,EACpBD,YAAY,CAACE,QAAQ,EACrBF,YAAY,CAACK,KAAK,EAClBL,YAAY,CAACM,OAAO,EACpBN,YAAY,CAACjC,OAAO,EACpBiC,YAAY,CAACO,OAAO,EACpBP,YAAY,CAACQ,IAAI,CAClB;EAED,KAAK,MAAMC,SAAS,IAAIhE,UAAU,EAAE;IAClC,IAAIgE,SAAS,KAAK1B,SAAS,IAAI0B,SAAS,KAAK,IAAI,EAAE;MACjD,OAAOA,SAAS;IAClB;EACF;;EAEA;EACA,OAAOT,YAAY;AACrB;AAEA,SAASU,cAAcA,CAACC,QAAQ,EAAE;EAChC,IAAI,CAACA,QAAQ,CAACC,EAAE,EAAE;IAChB,IAAID,QAAQ,CAACtB,MAAM,KAAK,GAAG,EAAE;MAC3B5D,YAAY,CAACoF,UAAU,CAAC,OAAO,CAAC;MAChCpF,YAAY,CAACoF,UAAU,CAAC,MAAM,CAAC;MAC/BpF,YAAY,CAACoF,UAAU,CAAC,WAAW,CAAC;MACpCC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;IACjC;IACA,OAAOL,QAAQ,CAACM,IAAI,CAAC,CAAC,CAACC,IAAI,CAACD,IAAI,IAAI;MAClC,IAAI;QACF,MAAMnB,KAAK,GAAGmB,IAAI,GAAGE,IAAI,CAACC,KAAK,CAACH,IAAI,CAAC,GAAG;UAAE1B,OAAO,EAAE,gBAAgB;UAAEF,MAAM,EAAEsB,QAAQ,CAACtB;QAAO,CAAC;QAC9F,OAAOgC,OAAO,CAACC,MAAM,CAACxB,KAAK,CAAC;MAC9B,CAAC,CAAC,OAAOyB,CAAC,EAAE;QACV,OAAOF,OAAO,CAACC,MAAM,CAAC;UAAE/B,OAAO,EAAE0B,IAAI,IAAI,gBAAgB;UAAE5B,MAAM,EAAEsB,QAAQ,CAACtB;QAAO,CAAC,CAAC;MACvF;IACF,CAAC,CAAC;EACJ;EACA;EACA,OAAOsB,QAAQ,CAACM,IAAI,CAAC,CAAC,CAACC,IAAI,CAACD,IAAI,IAAI;IAClC,IAAI,CAACA,IAAI,EAAE;MACT;MACA,OAAO;QAAE9B,OAAO,EAAE,IAAI;QAAEE,MAAM,EAAE;MAAU,CAAC;IAC7C;IACA,IAAI;MACF,MAAMmC,MAAM,GAAGL,IAAI,CAACC,KAAK,CAACH,IAAI,CAAC;MAC/B;MACA,OAAOlB,uBAAuB,CAACyB,MAAM,CAAC;IACxC,CAAC,CAAC,OAAOD,CAAC,EAAE;MACV;MACA,OAAO;QAAEpC,OAAO,EAAE,IAAI;QAAEnB,IAAI,EAAEiD;MAAK,CAAC;IACtC;EACF,CAAC,CAAC;AACJ;;AAEA;AACA,OAAO,SAASQ,gBAAgBA,CAACC,CAAC,EAAE;EAClC,IAAI,CAACA,CAAC,IAAI,OAAOA,CAAC,KAAK,QAAQ,EAAE;IAC/B,OAAO;MACLrD,EAAE,EAAEe,MAAM,CAACuC,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC;MACzB7F,IAAI,EAAE,kBAAkB;MACxB8F,WAAW,EAAE,EAAE;MACfC,KAAK,EAAE,CAAC;MACRC,MAAM,EAAE,CAAC,kDAAkD,CAAC;MAC5DC,KAAK,EAAE,kDAAkD;MACzDC,GAAG,EAAE,SAAS;MACdC,MAAM,EAAE,SAAS;MACjBC,KAAK,EAAE,SAAS;MAChBC,SAAS,EAAE,MAAM;MACjBC,MAAM,EAAE,CAAC,OAAO,CAAC;MACjBC,KAAK,EAAE,OAAO;MACdC,KAAK,EAAE,CAAC,GAAG,CAAC;MACZC,IAAI,EAAE,GAAG;MACTC,KAAK,EAAE,KAAK;MACZC,OAAO,EAAE,IAAI;MACbC,UAAU,EAAE,CAAC;MACbC,OAAO,EAAE,IAAI;MACbC,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;IACpC,CAAC;EACH;EAEA,MAAMC,SAAS,GAAG9E,KAAK,CAACC,OAAO,CAACuD,CAAC,CAACK,MAAM,CAAC,GACrCL,CAAC,CAACK,MAAM,GACRL,CAAC,CAACuB,OAAO,GACTvB,CAAC,CAACuB,OAAO,GACTvB,CAAC,CAACM,KAAK,GACP,CAACN,CAAC,CAACM,KAAK,CAAC,GACT,EAAE;EAEN,MAAMkB,YAAY,GAAGF,SAAS,CAAC3G,MAAM,GAAG,CAAC,GACrC2G,SAAS,CAAC,CAAC,CAAC,GACXtB,CAAC,CAACyB,SAAS,IAAI,kDAAmD;EAEvE,MAAMC,SAAS,GAAGlF,KAAK,CAACC,OAAO,CAACuD,CAAC,CAACW,MAAM,CAAC,GACrCX,CAAC,CAACW,MAAM,GACRX,CAAC,CAACY,KAAK,GACP,CAACZ,CAAC,CAACY,KAAK,CAAC,GACT,CAAC,OAAO,CAAC;EAEb,MAAMe,QAAQ,GAAGnF,KAAK,CAACC,OAAO,CAACuD,CAAC,CAACa,KAAK,CAAC,GACnCb,CAAC,CAACa,KAAK,GACPb,CAAC,CAACc,IAAI,GACN,CAACd,CAAC,CAACc,IAAI,CAAC,GACR,CAAC,GAAG,CAAC;EAET,MAAMc,QAAQ,GAAG,OAAO5B,CAAC,CAACI,KAAK,KAAK,QAAQ,GAAGJ,CAAC,CAACI,KAAK,GAAGyB,UAAU,CAAC7B,CAAC,CAACI,KAAK,CAAC;EAC5E,MAAM0B,KAAK,GAAG9B,CAAC,CAACkB,OAAO,IAAIlB,CAAC,CAAC+B,IAAI,KAAK/B,CAAC,CAACmB,SAAS,GAAG,IAAIC,IAAI,CAACpB,CAAC,CAACmB,SAAS,CAAC,CAACa,WAAW,CAAC,CAAC,GAAG3E,SAAS,CAAC,IAAI,IAAI;EAE5G,OAAO;IACLV,EAAE,EAAEqD,CAAC,CAACrD,EAAE,IAAIqD,CAAC,CAACvB,GAAG,IAAIuB,CAAC,CAACtB,SAAS,IAAIsB,CAAC,CAACiC,IAAI,IAAIvE,MAAM,CAACuC,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC;IACnE7F,IAAI,EAAE2F,CAAC,CAAC3F,IAAI,IAAI2F,CAAC,CAACkC,KAAK,IAAI,kBAAkB;IAC7C/B,WAAW,EAAEH,CAAC,CAACG,WAAW,IAAIH,CAAC,CAACmC,IAAI,IAAI,EAAE;IAC1C/B,KAAK,EAAEgC,MAAM,CAACC,QAAQ,CAACT,QAAQ,CAAC,GAAGA,QAAQ,GAAG,CAAC;IAC/CvB,MAAM,EAAEiB,SAAS,CAAC3G,MAAM,GAAG,CAAC,GAAG2G,SAAS,GAAG,CAACE,YAAY,CAAC;IACzDlB,KAAK,EAAEkB,YAAY;IACnBjB,GAAG,EAAEP,CAAC,CAACO,GAAG,IAAIP,CAAC,CAACQ,MAAM,IAAIR,CAAC,CAACsC,QAAQ,IAAI,SAAS;IACjD9B,MAAM,EAAER,CAAC,CAACQ,MAAM,IAAIR,CAAC,CAACO,GAAG,IAAI,SAAS;IACtCE,KAAK,EAAET,CAAC,CAACS,KAAK,IAAIT,CAAC,CAACsC,QAAQ,IAAI,SAAS;IACzC5B,SAAS,EAAEV,CAAC,CAACU,SAAS,IAAI,MAAM;IAChCC,MAAM,EAAEe,SAAS;IACjBd,KAAK,EAAEc,SAAS,CAAC,CAAC,CAAC;IACnBb,KAAK,EAAEc,QAAQ;IACfb,IAAI,EAAEa,QAAQ,CAAC,CAAC,CAAC;IACjBZ,KAAK,EAAE,CAAC,CAACf,CAAC,CAACe,KAAK;IAChBC,OAAO,EAAEhB,CAAC,CAACgB,OAAO,KAAK3D,SAAS,GAAG,CAAC,CAAC2C,CAAC,CAACgB,OAAO,GAAG,IAAI;IACrDC,UAAU,EAAEjB,CAAC,CAACiB,UAAU,IAAI,CAAC;IAC7BC,OAAO,EAAEY,KAAK;IACdX,SAAS,EAAEnB,CAAC,CAACmB,SAAS,IAAI,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;IAClDiB,QAAQ,EAAEtC,CAAC,CAACsC,QAAQ,IAAItC,CAAC,CAACS,KAAK,IAAIpD;EACrC,CAAC;AACH;AAEA,OAAO,SAASkF,iBAAiBA,CAAC5D,KAAK,EAAE;EACvC,IAAI,CAACnC,KAAK,CAACC,OAAO,CAACkC,KAAK,CAAC,EAAE,OAAO,EAAE;EACpC,OAAOA,KAAK,CAAC6D,GAAG,CAACzC,gBAAgB,CAAC;AACpC;;AAEA;AACA,SAAS0C,oBAAoBA,CAACpG,OAAO,EAAE;EACrC,IAAIG,KAAK,CAACC,OAAO,CAACJ,OAAO,CAAC,EAAE,OAAOA,OAAO;EAC1C;EACA,MAAMqG,aAAa,GAAG,CACpBrG,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEmC,QAAQ,EACjBnC,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEC,IAAI,EACbD,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEsC,KAAK,EACdtC,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEuC,OAAO,EAChBvC,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEsG,OAAO,EAChBtG,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEuG,IAAI,EACbvG,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEwG,IAAI,CACd;EACD,KAAK,MAAMC,IAAI,IAAIJ,aAAa,EAAE;IAChC,IAAIlG,KAAK,CAACC,OAAO,CAACqG,IAAI,CAAC,EAAE,OAAOA,IAAI;EACtC;EACA;EACA,MAAMC,OAAO,GAAG1G,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEC,IAAI;EAC7B,IAAIyG,OAAO,IAAI,OAAOA,OAAO,KAAK,QAAQ,EAAE;IAC1C,MAAMC,gBAAgB,GAAG,CACvBD,OAAO,CAACvE,QAAQ,EAChBuE,OAAO,CAACpE,KAAK,EACboE,OAAO,CAACnE,OAAO,EACfmE,OAAO,CAACJ,OAAO,EACfI,OAAO,CAACH,IAAI,EACZG,OAAO,CAACF,IAAI,CACb;IACD,KAAK,MAAMC,IAAI,IAAIE,gBAAgB,EAAE;MACnC,IAAIxG,KAAK,CAACC,OAAO,CAACqG,IAAI,CAAC,EAAE,OAAOA,IAAI;IACtC;EACF;EACA,OAAO,IAAI;AACb;;AAEA;AACA,OAAO,MAAMG,WAAW,GAAG;EACzB;EACAC,QAAQ,EAAE,MAAO5G,IAAI,IAAK;IACxB,MAAMxC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAC3C,MAAMmJ,UAAU,GAAG,CACjBzJ,aAAa,CAACwJ,QAAQ,CACvB;IAED,MAAME,WAAW,GAAGtJ,KAAK,GACrB;MAAE,cAAc,EAAE,kBAAkB;MAAEuJ,MAAM,EAAE,kBAAkB;MAAEpJ,aAAa,EAAE,UAAUH,KAAK;IAAG,CAAC,GACpG;MAAE,cAAc,EAAE,kBAAkB;MAAEuJ,MAAM,EAAE;IAAmB,CAAC;IAEtE,IAAIC,SAAS;IACb;IACA,IAAI;MAAE,MAAMxI,eAAe,CAAC,CAAC;IAAE,CAAC,CAAC,OAAOU,CAAC,EAAE,CAAC;IAC5C,KAAK,MAAMR,IAAI,IAAImI,UAAU,EAAE;MAC7B,IAAI;QACF,MAAMI,GAAG,GAAG,GAAG9J,YAAY,GAAGuB,IAAI,EAAE;QACpC,MAAMwI,IAAI,GAAG,MAAMvI,KAAK,CAACsI,GAAG,EAAE;UAC5BrI,MAAM,EAAE,MAAM;UACdQ,OAAO,EAAED,QAAQ,CAAC2H,WAAW,CAAC;UAC9BjI,WAAW,EAAE,SAAS;UACtBC,IAAI,EAAE,MAAM;UACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;QAC3B,CAAC,CAAC;QACF,IAAI;UAAEoH,OAAO,CAACC,KAAK,CAAC,iBAAiB,EAAE,MAAM,EAAEJ,GAAG,EAAE,SAAS,EAAEC,IAAI,CAAC7F,MAAM,CAAC;QAAE,CAAC,CAAC,OAAOnC,CAAC,EAAE,CAAC;QAC1F,MAAMsE,MAAM,GAAG,MAAMd,cAAc,CAACwE,IAAI,CAAC;QACzC,OAAO5H,oBAAoB,CAACkE,MAAM,CAAC;MACrC,CAAC,CAAC,OAAO8D,GAAG,EAAE;QACZN,SAAS,GAAGM,GAAG;QACf;QACA,IAAIA,GAAG,KAAKA,GAAG,CAACjG,MAAM,KAAK,GAAG,IAAIiG,GAAG,CAACC,UAAU,KAAK,GAAG,CAAC,EAAE;MAC7D;IACF;IACA,MAAMP,SAAS,IAAI,IAAIQ,KAAK,CAAC,6BAA6B,CAAC;EAC7D,CAAC;EACDC,KAAK,EAAE,MAAOzH,IAAI,IAAK;IACrB,MAAM6G,UAAU,GAAG,CACjBzJ,aAAa,CAACqK,KAAK,EACnB,iBAAiB,EACjB,yBAAyB,CAC1B;IAED,IAAIT,SAAS;IACb,IAAI;MAAE,MAAMxI,eAAe,CAAC,CAAC;IAAE,CAAC,CAAC,OAAOU,CAAC,EAAE,CAAC;IAC5C,KAAK,MAAMR,IAAI,IAAImI,UAAU,EAAE;MAC7B,IAAI;QACF,MAAMI,GAAG,GAAG,GAAG9J,YAAY,GAAGuB,IAAI,EAAE;QACpC,MAAMwI,IAAI,GAAG,MAAMvI,KAAK,CAACsI,GAAG,EAAE;UAC5BrI,MAAM,EAAE,MAAM;UACdQ,OAAO,EAAED,QAAQ,CAAC5B,cAAc,CAAC,CAAC,CAAC;UACnCsB,WAAW,EAAE,SAAS;UACtBC,IAAI,EAAE,MAAM;UACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;QAC3B,CAAC,CAAC;QACF,IAAI;UAAEoH,OAAO,CAACC,KAAK,CAAC,cAAc,EAAE,MAAM,EAAEJ,GAAG,EAAE,SAAS,EAAEC,IAAI,CAAC7F,MAAM,CAAC;QAAE,CAAC,CAAC,OAAOnC,CAAC,EAAE,CAAC;;QAEvF;QACA,MAAMwI,UAAU,GACdR,IAAI,CAAC9H,OAAO,CAACuI,GAAG,CAAC,eAAe,CAAC,IACjCT,IAAI,CAAC9H,OAAO,CAACuI,GAAG,CAAC,eAAe,CAAC,IACjCT,IAAI,CAAC9H,OAAO,CAACuI,GAAG,CAAC,gBAAgB,CAAC,IAClCT,IAAI,CAAC9H,OAAO,CAACuI,GAAG,CAAC,cAAc,CAAC;QAElC,MAAMnE,MAAM,GAAG,MAAMd,cAAc,CAACwE,IAAI,CAAC;QAEzC,IAAIQ,UAAU,EAAE;UACd,MAAME,OAAO,GAAGF,UAAU,CAAC5G,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC;UACrD,IAAI;YACFrD,YAAY,CAACoK,OAAO,CAAC,OAAO,EAAED,OAAO,CAAC;YACtCnK,YAAY,CAACoK,OAAO,CAAC,WAAW,EAAED,OAAO,CAAC;UAC5C,CAAC,CAAC,OAAO1I,CAAC,EAAE,CAAC;UACb,IAAIsE,MAAM,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE;YACxCA,MAAM,CAAC3C,aAAa,GAAG6G,UAAU;YACjC,IAAI,CAAClE,MAAM,CAAChG,KAAK,EAAEgG,MAAM,CAAChG,KAAK,GAAGoK,OAAO;UAC3C;QACF;QAEA,MAAME,UAAU,GAAGxI,oBAAoB,CAACkE,MAAM,CAAC;QAC/C,IAAIkE,UAAU,EAAE;UACd;UACA,MAAME,OAAO,GAAGF,UAAU,CAAC5G,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC;UACrD,IAAI;YACFrD,YAAY,CAACoK,OAAO,CAAC,OAAO,EAAED,OAAO,CAAC;YACtCnK,YAAY,CAACoK,OAAO,CAAC,WAAW,EAAED,OAAO,CAAC;UAC5C,CAAC,CAAC,OAAO1I,CAAC,EAAE,CAAC;UACb4I,UAAU,CAACjH,aAAa,GAAG6G,UAAU;UACrC,IAAI,CAACI,UAAU,CAACtK,KAAK,EAAEsK,UAAU,CAACtK,KAAK,GAAGoK,OAAO;QACnD;QACA,OAAOE,UAAU;MACnB,CAAC,CAAC,OAAOR,GAAG,EAAE;QACZN,SAAS,GAAGM,GAAG;QACf;QACA,IAAIA,GAAG,KAAKA,GAAG,CAACjG,MAAM,KAAK,GAAG,IAAIiG,GAAG,CAACC,UAAU,KAAK,GAAG,CAAC,EAAE;MAC7D;IACF;IACA,MAAMP,SAAS,IAAI,IAAIQ,KAAK,CAAC,sBAAsB,CAAC;EACtD,CAAC;EACDO,MAAM,EAAE,MAAAA,CAAA,KAAY;IAClB,IAAI;MACF,MAAMpF,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC2K,MAAM,EAAE,EAAE;QACrEnJ,MAAM,EAAE,MAAM;QACdQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkJ,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7ClF,YAAY,CAACoF,UAAU,CAAC,OAAO,CAAC;MAChCpF,YAAY,CAACoF,UAAU,CAAC,WAAW,CAAC;MACpCpF,YAAY,CAACoF,UAAU,CAAC,MAAM,CAAC;MAC/B,OAAOd,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,gBAAgB,EAAEA,KAAK,CAAC;MACtC;MACArE,YAAY,CAACoF,UAAU,CAAC,OAAO,CAAC;MAChCpF,YAAY,CAACoF,UAAU,CAAC,WAAW,CAAC;MACpCpF,YAAY,CAACoF,UAAU,CAAC,MAAM,CAAC;MAC/B,OAAO;QAAE1B,OAAO,EAAE;MAAK,CAAC;IAC1B;EACF,CAAC;EACD8G,WAAW,EAAE,MAAOjI,IAAI,IAAK;IAC3B,IAAI;MACF,MAAM2C,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC6K,WAAW,EAAE,EAAE;QAC1ErJ,MAAM,EAAE,MAAM;QACdQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;MAC3B,CAAC,CAAC;MACF,MAAMgI,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MAClD,MAAMA,KAAK;IACb;EACF,CAAC;EACDoG,kBAAkB,EAAE,MAAOlI,IAAI,IAAK;IAClC,IAAI;MACF,MAAM2C,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC8K,kBAAkB,EAAE,EAAE;QACjFtJ,MAAM,EAAE,MAAM;QACdQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;MAC3B,CAAC,CAAC;MACF,MAAMgI,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACnD,MAAMA,KAAK;IACb;EACF;AACF,CAAC;;AAED;AACA,OAAO,MAAMqG,WAAW,GAAG;EACzBC,UAAU,EAAE,MAAAA,CAAA,KAAY;IACtB,MAAMvB,UAAU,GAAG,CACjBzJ,aAAa,CAACyE,OAAO,EACrB,mBAAmB,EACnB,cAAc,EACd,eAAe,EACf,cAAc,EACd,SAAS,CACV;IAED,IAAImF,SAAS;IACb,KAAK,MAAMtI,IAAI,IAAImI,UAAU,EAAE;MAC7B,IAAI;QACF,MAAMK,IAAI,GAAG,MAAMvI,KAAK,CAAC,GAAGxB,YAAY,GAAGuB,IAAI,EAAE,EAAE;UACjDU,OAAO,EAAE7B,cAAc,CAAC,CAAC;UACzBsB,WAAW,EAAE,SAAS;UACtBC,IAAI,EAAE;QACR,CAAC,CAAC;QACF,MAAMkB,IAAI,GAAG,MAAM0C,cAAc,CAACwE,IAAI,CAAC;QACvC,MAAMrF,OAAO,GAAGE,uBAAuB,CAAC/B,IAAI,CAAC;QAC7C,OAAO6B,OAAO,IAAI7B,IAAI;MACxB,CAAC,CAAC,OAAOsH,GAAG,EAAE;QACZN,SAAS,GAAGM,GAAG;QACf,IAAIA,GAAG,KAAKA,GAAG,CAACjG,MAAM,KAAK,GAAG,IAAIiG,GAAG,CAACC,UAAU,KAAK,GAAG,CAAC,EAAE;UACzD,SAAS,CAAC;QACZ;MACF;IACF;IACA,MAAMP,SAAS,IAAI;MAAEzF,OAAO,EAAE,4BAA4B;MAAEF,MAAM,EAAE;IAAI,CAAC;EAC3E,CAAC;EACDgH,aAAa,EAAE,MAAOrI,IAAI,IAAK;IAC7B,IAAI;MACF,MAAM2C,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAACiL,aAAa,EAAE,EAAE;QAC5EzJ,MAAM,EAAE,KAAK;QACbQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;MAC3B,CAAC,CAAC;MACF,MAAMgI,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjD,MAAMA,KAAK;IACb;EACF,CAAC;EACDwG,iBAAiB,EAAE,MAAOtI,IAAI,IAAK;IACjC,IAAI;MACF,MAAM2C,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAACmL,WAAW,EAAE,EAAE;QAC1E3J,MAAM,EAAE,KAAK;QACbQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;MAC3B,CAAC,CAAC;MACF,MAAMgI,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACrD,MAAMA,KAAK;IACb;EACF;AACF,CAAC;;AAED;AACA,OAAO,MAAM0G,cAAc,GAAG;EAC5BC,WAAW,EAAE,MAAOC,MAAM,IAAK;IAC7B,MAAMC,KAAK,GAAGD,MAAM,GAAG,GAAG,GAAG,IAAIE,eAAe,CAACF,MAAM,CAAC,CAACG,QAAQ,CAAC,CAAC,GAAG,EAAE;IACxE,MAAMrL,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAC3C,MAAM0B,OAAO,GAAG5B,KAAK,GAAG;MAAEG,aAAa,EAAE,UAAUH,KAAK,EAAE;MAAEuJ,MAAM,EAAE;IAAmB,CAAC,GAAG;MAAEA,MAAM,EAAE;IAAmB,CAAC;IAEzH,MAAM+B,UAAU,GAAG,GAAG3L,YAAY,GAAGC,aAAa,CAAC8E,QAAQ,GAAGyG,KAAK,EAAE;IACrE,MAAMI,UAAU,GAAG,CACjB3L,aAAa,CAAC8E,QAAQ,EACtB;IACA;IAAA,CACD;IAED,MAAM8G,SAAS,GAAGlE,IAAI,CAACmE,GAAG,CAAC,CAAC;IAC5B,MAAMC,cAAc,GAAI5B,GAAG,IAAK;MAC9B,IAAI,CAACA,GAAG,EAAE,OAAO,KAAK;MACtB,MAAM6B,GAAG,GAAG/H,MAAM,CAACkG,GAAG,CAAC/F,OAAO,IAAI,EAAE,CAAC,CAACD,WAAW,CAAC,CAAC;MACnD,OACEgG,GAAG,CAACvJ,IAAI,KAAK,WAAW,IACxBoL,GAAG,CAAC3H,QAAQ,CAAC,iBAAiB,CAAC,IAC/B2H,GAAG,CAAC3H,QAAQ,CAAC,cAAc,CAAC,IAC5B2H,GAAG,CAAC3H,QAAQ,CAAC,iBAAiB,CAAC,IAC/B2H,GAAG,CAAC3H,QAAQ,CAAC,SAAS,CAAC,IACvB2H,GAAG,CAAC3H,QAAQ,CAAC,qBAAqB,CAAC;IAEvC,CAAC;IAED,IAAI;MACF,MAAM0F,IAAI,GAAG,MAAMvI,KAAK,CAACmK,UAAU,EAAE;QACnC1J,OAAO;QACPN,IAAI,EAAE,MAAM;QACZD,WAAW,EAAE;MACf,CAAC,CAAC;MACF,MAAMmB,IAAI,GAAG,MAAM0C,cAAc,CAACwE,IAAI,CAAC;MACvC,MAAMkC,WAAW,GAAGjD,oBAAoB,CAACnG,IAAI,CAAC;MAC9C,IAAIoJ,WAAW,EAAE;QACf,MAAMtB,UAAU,GAAG7B,iBAAiB,CAACmD,WAAW,CAAC;QACjD9L,OAAO,CAAC+L,OAAO,CAAC,oCAAoC,EAAE;UACpDpC,GAAG,EAAE6B,UAAU;UACfQ,WAAW,EAAExE,IAAI,CAACmE,GAAG,CAAC,CAAC,GAAGD,SAAS;UACnCO,KAAK,EAAEzB,UAAU,CAACzJ;QACpB,CAAC,CAAC;QACF,OAAOyJ,UAAU;MACnB;MACA;MACA,IAAI;QACFhF,MAAM,CAAC0G,aAAa,CAAC,IAAIC,WAAW,CAAC,0BAA0B,EAAE;UAAEC,MAAM,EAAE;YAAEC,QAAQ,EAAE;UAAW;QAAE,CAAC,CAAC,CAAC;MACzG,CAAC,CAAC,OAAOzK,CAAC,EAAE,CAAC;MACb,IAAI;QAAE4D,MAAM,CAAC8G,wBAAwB,GAAG,IAAI;MAAE,CAAC,CAAC,OAAO1K,CAAC,EAAE,CAAC;MAC3D5B,OAAO,CAACuM,OAAO,CAAC,qDAAqD,EAAE;QACrE5C,GAAG,EAAE6B,UAAU;QACfQ,WAAW,EAAExE,IAAI,CAACmE,GAAG,CAAC,CAAC,GAAGD,SAAS;QACnCc,YAAY,EAAEC,MAAM,CAACC,IAAI,CAAChK,IAAI,IAAI,CAAC,CAAC;MACtC,CAAC,CAAC;MACF,OAAO3C,YAAY;IACrB,CAAC,CAAC,OAAOiK,GAAG,EAAE;MAAA,IAAA2C,UAAA,EAAAC,WAAA,EAAAC,WAAA;MACZ7M,OAAO,CAAC8M,QAAQ,CAAC,kCAAkC,EAAE;QACnDnD,GAAG,EAAE6B,UAAU;QACfQ,WAAW,EAAExE,IAAI,CAACmE,GAAG,CAAC,CAAC,GAAGD,SAAS;QACnCqB,aAAa,EAAE/C,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAE/F,OAAO;QAC3B+I,UAAU,EAAEhD,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEvJ,IAAI;QACrBwM,MAAM,EAAE,OAAOC,SAAS,KAAK,WAAW,GAAGA,SAAS,CAACC,MAAM,GAAG1J;MAChE,CAAC,CAAC;;MAEF;MACA,IAAIiG,SAAS,GAAGM,GAAG;MACnB,KAAK,MAAM5I,IAAI,IAAIqK,UAAU,EAAE;QAC7B,MAAM2B,MAAM,GAAG,GAAGvN,YAAY,GAAGuB,IAAI,GAAGiK,KAAK,EAAE;QAC/C,IAAI;UACF,MAAMgC,QAAQ,GAAG7F,IAAI,CAACmE,GAAG,CAAC,CAAC;UAC3B,MAAM2B,CAAC,GAAG,MAAMjM,KAAK,CAAC+L,MAAM,EAAE;YAAEtL,OAAO;YAAEN,IAAI,EAAE,MAAM;YAAED,WAAW,EAAE;UAAU,CAAC,CAAC;UAChF,MAAMgM,CAAC,GAAG,MAAMnI,cAAc,CAACkI,CAAC,CAAC;UACjC,MAAME,GAAG,GAAG3E,oBAAoB,CAAC0E,CAAC,CAAC;UACnC,IAAIC,GAAG,EAAE;YACP,MAAMhD,UAAU,GAAG7B,iBAAiB,CAAC6E,GAAG,CAAC;YACzCxN,OAAO,CAACuM,OAAO,CAAC,0CAA0C,EAAE;cAC1D5C,GAAG,EAAEyD,MAAM;cACXpB,WAAW,EAAExE,IAAI,CAACmE,GAAG,CAAC,CAAC,GAAG0B,QAAQ;cAClCpB,KAAK,EAAEzB,UAAU,CAACzJ;YACpB,CAAC,CAAC;YACF,OAAOyJ,UAAU;UACnB;UACA;UACA,IAAI;YACFhF,MAAM,CAAC0G,aAAa,CAAC,IAAIC,WAAW,CAAC,0BAA0B,EAAE;cAAEC,MAAM,EAAE;gBAAEC,QAAQ,EAAE;cAAW;YAAE,CAAC,CAAC,CAAC;UACzG,CAAC,CAAC,OAAOzK,CAAC,EAAE,CAAC;UACb,IAAI;YAAE4D,MAAM,CAAC8G,wBAAwB,GAAG,IAAI;UAAE,CAAC,CAAC,OAAO1K,CAAC,EAAE,CAAC;UAC3D5B,OAAO,CAACuM,OAAO,CAAC,2DAA2D,EAAE;YAC3E5C,GAAG,EAAEyD,MAAM;YACXpB,WAAW,EAAExE,IAAI,CAACmE,GAAG,CAAC,CAAC,GAAG0B,QAAQ;YAClCb,YAAY,EAAEC,MAAM,CAACC,IAAI,CAACa,CAAC,IAAI,CAAC,CAAC;UACnC,CAAC,CAAC;UACF,OAAOxN,YAAY;QACrB,CAAC,CAAC,OAAO0N,IAAI,EAAE;UACb/D,SAAS,GAAG+D,IAAI;UAChB;UACA,IAAI,EAAE7B,cAAc,CAAC6B,IAAI,CAAC,IAAKA,IAAI,KAAKA,IAAI,CAAC1J,MAAM,KAAK,GAAG,IAAI0J,IAAI,CAACxD,UAAU,KAAK,GAAG,CAAE,CAAC,EAAE;YACzF;UACF;QACF;MACF;;MAEA;MACA,IAAI;QACFzE,MAAM,CAAC0G,aAAa,CAAC,IAAIC,WAAW,CAAC,0BAA0B,EAAE;UAAEC,MAAM,EAAE;YAAEC,QAAQ,EAAE;UAAW;QAAE,CAAC,CAAC,CAAC;MACzG,CAAC,CAAC,OAAOzK,CAAC,EAAE,CAAC;MACb,IAAI;QAAE4D,MAAM,CAAC8G,wBAAwB,GAAG,IAAI;MAAE,CAAC,CAAC,OAAO1K,CAAC,EAAE,CAAC;MAC3D5B,OAAO,CAACuM,OAAO,CAAC,qDAAqD,EAAE;QACrEmB,MAAM,EAAG,EAAAf,UAAA,GAAAjD,SAAS,cAAAiD,UAAA,uBAATA,UAAA,CAAW5I,MAAM,OAAA6I,WAAA,GAAIlD,SAAS,cAAAkD,WAAA,uBAATA,WAAA,CAAWnM,IAAI,OAAAoM,WAAA,GAAInD,SAAS,cAAAmD,WAAA,uBAATA,WAAA,CAAW5I,OAAO,KAAI,SAAU;QACjFgI,KAAK,EAAErJ,KAAK,CAACC,OAAO,CAAC9C,YAAY,CAAC,GAAGA,YAAY,CAACgB,MAAM,GAAG;MAC7D,CAAC,CAAC;MACF,OAAOhB,YAAY;IACrB;EACF,CAAC;EACD4N,UAAU,EAAE,MAAO5K,EAAE,IAAK;IACxB,IAAI;MACF,MAAMsC,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC6E,OAAO,CAAC5B,EAAE,CAAC,EAAE,EAAE;QAC1EjB,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkB,IAAI,GAAG,MAAM0C,cAAc,CAACC,QAAQ,CAAC;MAC3C;MACA,MAAMV,OAAO,GAAGF,uBAAuB,CAAC/B,IAAI,CAAC;MAC7C,OAAOyD,gBAAgB,CAACxB,OAAO,IAAIjC,IAAI,CAAC;IAC1C,CAAC,CAAC,OAAO8B,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MAChD,MAAMA,KAAK;IACb;EACF,CAAC;EACDoJ,cAAc,EAAE,MAAOvC,KAAK,IAAK;IAC/B,IAAI;MACF,MAAMhG,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC+N,MAAM,MAAMC,kBAAkB,CAACzC,KAAK,CAAC,EAAE,EAAE;QACpGvJ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkB,IAAI,GAAG,MAAM0C,cAAc,CAACC,QAAQ,CAAC;MAC3C,MAAMT,QAAQ,GAAGH,uBAAuB,CAAC/B,IAAI,CAAC;MAC9C,OAAOiG,iBAAiB,CAAC/F,KAAK,CAACC,OAAO,CAAC+B,QAAQ,CAAC,GAAGA,QAAQ,GAAG,EAAE,CAAC;IACnE,CAAC,CAAC,OAAOJ,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MAClD,OAAO,EAAE;IACX;EACF,CAAC;EACDuJ,aAAa,EAAE,MAAAA,CAAA,KAAY;IACzB,IAAI;MACF,MAAM1I,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAACkO,UAAU,EAAE,EAAE;QACzElM,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkB,IAAI,GAAG,MAAM0C,cAAc,CAACC,QAAQ,CAAC;MAC3C,OAAOZ,uBAAuB,CAAC/B,IAAI,CAAC,IAAI,EAAE;IAC5C,CAAC,CAAC,OAAO8B,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACnD,OAAO,EAAE;IACX;EACF,CAAC;EACDyJ,UAAU,EAAE,MAAAA,CAAA,KAAY;IACtB,IAAI;MACF,MAAM5I,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAACoO,OAAO,EAAE,EAAE;QACtEpM,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkB,IAAI,GAAG,MAAM0C,cAAc,CAACC,QAAQ,CAAC;MAC3C,OAAOZ,uBAAuB,CAAC/B,IAAI,CAAC,IAAI,CAAC,CAAC;IAC5C,CAAC,CAAC,OAAO8B,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MAChD,OAAO,CAAC,CAAC;IACX;EACF;AACF,CAAC;;AAED;AACA,OAAO,MAAM2J,aAAa,GAAG;EAC3BC,UAAU,EAAE,MAAOtJ,SAAS,IAAK;IAC/B,IAAI;MACF,MAAMO,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAACuO,OAAO,CAACvJ,SAAS,CAAC,EAAE,EAAE;QACjFhD,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkB,IAAI,GAAG,MAAM0C,cAAc,CAACC,QAAQ,CAAC;MAC3C,OAAOZ,uBAAuB,CAAC/B,IAAI,CAAC,IAAI,EAAE;IAC5C,CAAC,CAAC,OAAO8B,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MAChD,OAAO,EAAE;IACX;EACF,CAAC;EACD8J,SAAS,EAAE,MAAAA,CAAOxJ,SAAS,EAAEpC,IAAI,KAAK;IACpC,IAAI;MACF,MAAM2C,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAACwO,SAAS,CAACxJ,SAAS,CAAC,EAAE,EAAE;QACnFxD,MAAM,EAAE,MAAM;QACdQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;MAC3B,CAAC,CAAC;MACF,MAAMgI,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;MAC7C,MAAMA,KAAK;IACb;EACF;AACF,CAAC;;AAED;AACA,OAAO,MAAM+J,eAAe,GAAG;EAC7BC,WAAW,EAAE,MAAAA,CAAA,KAAY;IACvB,IAAI;MACF,MAAMnJ,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC2O,QAAQ,EAAE,EAAE;QACvE3M,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkB,IAAI,GAAG,MAAM0C,cAAc,CAACC,QAAQ,CAAC;MAC3C,MAAMT,QAAQ,GAAGH,uBAAuB,CAAC/B,IAAI,CAAC;MAC9C,OAAOiG,iBAAiB,CAAC/F,KAAK,CAACC,OAAO,CAAC+B,QAAQ,CAAC,GAAGA,QAAQ,GAAG,EAAE,CAAC;IACnE,CAAC,CAAC,OAAOJ,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjD,OAAO,EAAE;IACX;EACF,CAAC;EACDkK,aAAa,EAAE,MAAO5J,SAAS,IAAK;IAClC,IAAI;MACF,MAAMO,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC6O,WAAW,EAAE,EAAE;QAC1ErN,MAAM,EAAE,MAAM;QACdQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAAC;UAAE/E;QAAU,CAAC;MACpC,CAAC,CAAC;MACF,MAAM4F,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MAClD,MAAMA,KAAK;IACb;EACF,CAAC;EACDoK,kBAAkB,EAAE,MAAO9J,SAAS,IAAK;IACvC,IAAI;MACF,MAAMO,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC+O,cAAc,EAAE,EAAE;QAC7EvN,MAAM,EAAE,MAAM;QACdQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAAC;UAAE/E;QAAU,CAAC;MACpC,CAAC,CAAC;MACF,MAAM4F,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;MACvD,MAAMA,KAAK;IACb;EACF;AACF,CAAC;;AAED;AACA,OAAO,MAAMsK,WAAW,GAAG;EACzBC,OAAO,EAAE,MAAAA,CAAA,KAAY;IACnB,IAAI;MACF,MAAM1J,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAACkP,IAAI,EAAE,EAAE;QACnElN,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkB,IAAI,GAAG,MAAM0C,cAAc,CAACC,QAAQ,CAAC;MAC3C,OAAOZ,uBAAuB,CAAC/B,IAAI,CAAC,IAAI;QAAEqC,KAAK,EAAE,EAAE;QAAEkK,KAAK,EAAE;MAAE,CAAC;IACjE,CAAC,CAAC,OAAOzK,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;MAC7C,OAAO;QAAEO,KAAK,EAAE,EAAE;QAAEkK,KAAK,EAAE;MAAE,CAAC;IAChC;EACF,CAAC;EACDC,SAAS,EAAE,MAAOxM,IAAI,IAAK;IACzB,IAAI;MACF,MAAMyM,iBAAiB,GAAG,OAAOrP,aAAa,CAACoP,SAAS,KAAK,QAAQ,GAChEpP,aAAa,CAACoP,SAAS,CAACE,UAAU,CAAC,SAAS,CAAC,IAAItP,aAAa,CAACoP,SAAS,CAACE,UAAU,CAAC,UAAU,CAAC,GAC5FtP,aAAa,CAACoP,SAAS,GACvB,GAAGrP,YAAY,GAAGC,aAAa,CAACoP,SAAS,EAAE,GAC/C,GAAGrP,YAAY,GAAGC,aAAa,CAACoP,SAAS,EAAE;MAE/C,MAAM7J,QAAQ,GAAG,MAAMhE,KAAK,CAAC8N,iBAAiB,EAAE;QAC9C7N,MAAM,EAAE,MAAM;QACdQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;MAC3B,CAAC,CAAC;MACF,MAAMgI,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAC9C,MAAMA,KAAK;IACb;EACF,CAAC;EACD6K,UAAU,EAAE,MAAO3M,IAAI,IAAK;IAC1B,IAAI;MACF,MAAM2C,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAACuP,UAAU,EAAE,EAAE;QACzE/N,MAAM,EAAE,KAAK;QACbQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;MAC3B,CAAC,CAAC;MACF,MAAMgI,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAC9C,MAAMA,KAAK;IACb;EACF,CAAC;EACD8K,cAAc,EAAE,MAAOC,MAAM,IAAK;IAChC,IAAI;MACF,MAAMlK,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAACwP,cAAc,CAACC,MAAM,CAAC,EAAE,EAAE;QACrFjO,MAAM,EAAE,QAAQ;QAChBQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkJ,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACnD,MAAMA,KAAK;IACb;EACF;AACF,CAAC;;AAED;AACA,OAAO,MAAMgL,YAAY,GAAG;EAC1BC,SAAS,EAAE,MAAAA,CAAA,KAAY;IACrB,IAAI;MACF,MAAMpK,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC4P,MAAM,EAAE,EAAE;QACrE5N,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkB,IAAI,GAAG,MAAM0C,cAAc,CAACC,QAAQ,CAAC;MAC3C,OAAOZ,uBAAuB,CAAC/B,IAAI,CAAC,IAAI,EAAE;IAC5C,CAAC,CAAC,OAAO8B,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MAC/C,OAAO,EAAE;IACX;EACF,CAAC;EACDmL,QAAQ,EAAE,MAAO5M,EAAE,IAAK;IACtB,IAAI;MACF,MAAMsC,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC8P,KAAK,CAAC7M,EAAE,CAAC,EAAE,EAAE;QACxEjB,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC;MACF,MAAMkB,IAAI,GAAG,MAAM0C,cAAc,CAACC,QAAQ,CAAC;MAC3C,OAAOZ,uBAAuB,CAAC/B,IAAI,CAAC,IAAI,IAAI;IAC9C,CAAC,CAAC,OAAO8B,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAC9C,MAAMA,KAAK;IACb;EACF,CAAC;EACDqL,WAAW,EAAE,MAAOnN,IAAI,IAAK;IAC3B,IAAI;MACF,MAAM2C,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAAC+P,WAAW,EAAE,EAAE;QAC1EvO,MAAM,EAAE,MAAM;QACdQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;MAC3B,CAAC,CAAC;MACF,MAAMgI,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MAC/C,MAAMA,KAAK;IACb;EACF;AACF,CAAC;;AAED;AACA,OAAO,MAAMsL,cAAc,GAAG;EAC5BC,WAAW,EAAE,MAAOrN,IAAI,IAAK;IAC3B,IAAI;MACF,MAAM2C,QAAQ,GAAG,MAAMhE,KAAK,CAAC,GAAGxB,YAAY,GAAGC,aAAa,CAACkQ,OAAO,EAAE,EAAE;QACtE1O,MAAM,EAAE,MAAM;QACdQ,OAAO,EAAE7B,cAAc,CAAC,CAAC;QACzBsB,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE,MAAM;QACZ0D,IAAI,EAAEW,IAAI,CAACgE,SAAS,CAACnH,IAAI;MAC3B,CAAC,CAAC;MACF,MAAMgI,MAAM,GAAG,MAAMtF,cAAc,CAACC,QAAQ,CAAC;MAC7C,OAAOZ,uBAAuB,CAACiG,MAAM,CAAC,IAAIA,MAAM;IAClD,CAAC,CAAC,OAAOlG,KAAK,EAAE;MACdsF,OAAO,CAACtF,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MAC/C,MAAMA,KAAK;IACb;EACF;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}